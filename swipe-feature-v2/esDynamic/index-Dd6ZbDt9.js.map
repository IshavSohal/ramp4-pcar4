{"version":3,"file":"index-Dd6ZbDt9.js","sources":["../../src/fixtures/swipe/swipe.vue","../../src/fixtures/swipe/index.ts"],"sourcesContent":["<template>\n    <div class=\"swipe-container\">\n        <div id=\"verticalLine\" :style=\"{ left: linePosition, height: lineHeight, bottom: lineBottom }\"></div>\n        <input\n            v-model=\"sliderPosition\"\n            :id=\"'layerSlider' + iApi?.$element._uid\"\n            class=\"layerSliderElement\"\n            type=\"range\"\n            ref=\"slider\"\n            min=\"0\"\n            aria-valuemin=\"0\"\n            aria-valuemax=\"90\"\n            :aria-valuenow=\"sliderPosition\"\n            :aria-label=\"$t('map.layerSwipe.label')\"\n            max=\"90\"\n            step=\"0.5\"\n            :content=\"$t('map.layerSwipe.drag')\"\n            v-tippy=\"{ followCursor: true }\"\n        />\n    </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { FixtureInstance } from '@/api';\nimport { computed, inject, onBeforeMount, onBeforeUnmount, onMounted, ref, useTemplateRef } from 'vue';\nimport { usePanelStore } from '@/stores/panel';\nimport type { InstanceAPI } from '@/api';\n\nconst iApi = inject<InstanceAPI>('iApi');\n\nconst panelStore = usePanelStore();\nconst slider = useTemplateRef('slider');\nconst sliderPosition = ref<number>(45);\nconst clientHeight = ref<number>(0);\nconst refreshCounter = ref(0);\n\nconst linePosition = computed(() => {\n    const thumbWidth = 30 + refreshCounter.value - refreshCounter.value;\n    const sliderWidth = slider.value?.clientWidth ?? 0;\n    const inputToPercentage = +sliderPosition.value / 90; // Percentage of slider that slider thumb has surpassed\n    const sliderOffset = (sliderWidth - thumbWidth) * inputToPercentage; // Number of pixels in slider that slider thumb has surpassed\n    const pos = (slider.value?.getBoundingClientRect().x ?? 0) + sliderOffset + (thumbWidth - 4) / 2;\n\n    const event = new CustomEvent('MoveInput', { detail: pos });\n    slider.value?.dispatchEvent(event);\n\n    return `${pos}px`;\n});\n\nconst lineHeight = computed(() => {\n    return `${clientHeight.value}px`;\n});\n\nconst lineBottom = computed(() => {\n    return `${-65 * (clientHeight.value / 1270)}px`;\n});\n\ndefineProps({\n    fixture: {\n        type: FixtureInstance,\n        required: true\n    },\n    message: String\n});\n\nonBeforeMount(() => {\n    clientHeight.value = iApi?.$rootEl?.clientHeight ?? 1200;\n});\n\nonMounted(() => {\n    window.addEventListener('resize', () => {\n        clientHeight.value = iApi?.$rootEl?.clientHeight ?? clientHeight.value;\n        refreshCounter.value++; // used to force update on window resize\n        setTimeout(() => {\n            refreshCounter.value++; // window minimizing/maximizing requires a second, delayed update\n        }, 50);\n    });\n    slider.value?.addEventListener('focus', () => panelStore.setOpacity(0.1));\n    slider.value?.addEventListener('blur', () => panelStore.setOpacity(1));\n    slider.value?.addEventListener('mouseover', () => panelStore.setOpacity(0.1));\n    slider.value?.addEventListener('mouseleave', () => panelStore.setOpacity(1));\n    setTimeout(() => {\n        refreshCounter.value++; // window minimizing/maximizing requires a second, delayed update\n    }, 50);\n});\n\nonBeforeUnmount(() => {\n    window.removeEventListener('resize', () => {\n        clientHeight.value = iApi?.$rootEl?.clientHeight ?? clientHeight.value;\n        refreshCounter.value++; // used to force update on window resize\n        setTimeout(() => {\n            refreshCounter.value++; // window minimizing/maximizing requires a second, delayed update\n        }, 50);\n    });\n    slider.value?.removeEventListener('focus', () => panelStore.setOpacity(0.1));\n    slider.value?.removeEventListener('blur', () => panelStore.setOpacity(1));\n    slider.value?.removeEventListener('mouseover', () => panelStore.setOpacity(0.1));\n    slider.value?.removeEventListener('mouseleave', () => panelStore.setOpacity(1));\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.swipe-container {\n    display: flex;\n    justify-content: center;\n    position: absolute;\n    width: 100%;\n    bottom: 5%;\n    padding-top: 20px;\n    padding-bottom: 20px;\n    background: linear-gradient(to right, rgba(0, 0, 0, 0) 5%, #4caf50 5%, #4caf50 95%, rgba(0, 0, 0, 0) 95%);\n    z-index: 0;\n}\n\n.layerSliderElement {\n    height: 5px;\n    width: 90%;\n    -webkit-appearance: none;\n    appearance: none;\n    //background: inherit;\n}\n\n.layerSliderElement:hover {\n    opacity: 1;\n}\n\n.layerSliderElement::-webkit-slider-thumb {\n    width: 30px;\n    height: 25px;\n    -webkit-appearance: none;\n    appearance: none;\n    background: black;\n    cursor: col-resize;\n}\n\n.layerSliderElement::-moz-range-thumb {\n    width: 30px;\n    height: 25px;\n    -webkit-appearance: none;\n    appearance: none;\n    background: black;\n    cursor: col-resize;\n}\n\n#verticalLine {\n    display: flex;\n    align-items: center;\n    position: absolute;\n    padding-right: 5px;\n    z-index: -15;\n    background: linear-gradient(#000, #000) no-repeat center/4px 100%;\n}\n</style>\n","import { EsriAPI } from '@/geo/esri';\nimport SwipeV from './swipe.vue'; // import on-map component\nimport { FixtureInstance } from '@/api';\n\nclass SwipeFixture extends FixtureInstance {\n    async added(): Promise<void> {\n        const { el, destroy } = this.mount(SwipeV, {\n            app: this.$element,\n            props: { message: 'This is a swipe.', fixture: this }\n        });\n\n        this.$vApp.$el.appendChild(el.childNodes[0]);\n\n        const leadingLayers = await EsriAPI.Collection();\n        const trailingLayers = await EsriAPI.Collection();\n        await this.$iApi.geo.map.viewPromise;\n        let view = this.$iApi.geo.map.esriView;\n        const natureLayer = this.$iApi.geo.layer.getLayer('Nature')?.esriLayer;\n        const waterLayer = this.$iApi.geo.layer.getLayer('Water')?.esriLayer;\n\n        leadingLayers.add(natureLayer);\n        trailingLayers.add(waterLayer);\n        let swipe = await EsriAPI.Swipe({ view, leadingLayers, trailingLayers, position: 50 });\n        //view?.ui.add(swipe);\n\n        const layerSliderId = '#layerSlider' + this.$element._uid; // uses ID of VueApp object to ensure uniqueness\n        const slider = this.$vApp.$el.querySelector(layerSliderId) as HTMLInputElement;\n        slider?.addEventListener('MoveInput', e => {\n            const evt = e as CustomEvent;\n            swipe.position = (evt.detail / this.$iApi?.$rootEl.clientWidth) * 100;\n        });\n\n        // Upon a basemap schema change, geo.map.esriView gets set to a new MapView, meaning that the one used by the\n        // swipe component wouldn't exist. So, we must reinitialize the swipe component\n        window.addEventListener('BasemapSchemaChange', async () => {\n            swipe.destroy();\n            view = this.$iApi.geo.map.esriView;\n            swipe = await EsriAPI.Swipe({ view, leadingLayers, trailingLayers, position: 50 });\n        });\n\n        this.removed = (): void => {\n            this.$vApp.$el.removeChild(el.childNodes[0]);\n            swipe.destroy();\n            destroy();\n        };\n    }\n}\n\nexport default SwipeFixture;\n"],"names":["iApi","inject","panelStore","usePanelStore","slider","useTemplateRef","sliderPosition","ref","clientHeight","refreshCounter","linePosition","computed","thumbWidth","sliderWidth","inputToPercentage","sliderOffset","pos","event","lineHeight","lineBottom","onBeforeMount","onMounted","onBeforeUnmount","SwipeFixture","FixtureInstance","el","destroy","SwipeV","leadingLayers","EsriAPI","trailingLayers","view","natureLayer","waterLayer","swipe","layerSliderId","e","evt"],"mappings":"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"}