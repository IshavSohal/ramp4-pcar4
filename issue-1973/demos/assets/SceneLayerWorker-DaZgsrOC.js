const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./i3s-C20NhPTt.js","./main-5ivotA7d.js","./preload-helper-dJJaZANz.js","./main-Dm4D1JVC.css","./projection-o15496_e.js","./mat3f64-BNcPSU_3.js","./mat4f64-UGgSIQpQ.js","./spatialReferenceEllipsoidUtils-BCtq26AC.js","./computeTranslationToOriginAndRotation-DpXeX_Fh.js","./DoubleArray-D04FUswz.js","./BufferView-BPu5ppB7.js","./vec3-B5zfTS4z.js","./vec4-g_DyLy6N.js"])))=>i.map(i=>d[i]);
import { _ as __vitePreload } from './preload-helper-dJJaZANz.js';
import { fr as n$2, bA as f$1, cB as _$1 } from './main-5ivotA7d.js';
import { y as y$1 } from './DoubleArray-D04FUswz.js';
import { i as i$1, a as a$1 } from './MeshLocalVertexSpace-zIkNRdee.js';
import { f, l as l$1 } from './vec3-B5zfTS4z.js';
import './sphere-iJDkIjO3.js';
import './I3SUtil-CoyjYiNh.js';
import './plane-BRaUgnbi.js';
import './mat3f64-BNcPSU_3.js';
import './mat4f64-UGgSIQpQ.js';
import './quatf64-C3zJJInI.js';
import './spatialReferenceEllipsoidUtils-BCtq26AC.js';
import './I3SBinaryReader-CUKAruT6.js';
import './VertexAttribute-CwgXid27.js';
import './floatRGBA-D-o7v5zT.js';
import './NormalAttribute.glsl-bm4BC8Pd.js';
import './interfaces-MbpZrcgP.js';
import './BindType-DQnxDFt3.js';
import './orientedBoundingBox-BmrHpGnx.js';
import './quat-DLoC7IGF.js';
import './computeTranslationToOriginAndRotation-DpXeX_Fh.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
var n$1,e$1;!function(n){n[n.None=0]="None",n[n.Int16=1]="Int16",n[n.Int32=2]="Int32";}(n$1||(n$1={})),function(n){n[n.Replace=0]="Replace",n[n.Outside=1]="Outside",n[n.Inside=2]="Inside",n[n.Finished=3]="Finished";}(e$1||(e$1={}));

function e(){return n||(n=new Promise((t=>__vitePreload(() => import('./i3s-C20NhPTt.js'),true?__vite__mapDeps([0,1,2,3]):void 0,import.meta.url).then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i,onRuntimeInitialized:()=>t(n)});delete n.then;})))).catch((t=>{throw t}))),n}function i(e){return n$2(`esri/libs/i3s/${e}`)}let n;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
var o,r,a,d$1,c;!function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked";}(o||(o={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked";}(r||(r={}));!function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached";}(a||(a={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera";}(d$1||(d$1={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf";}(c||(c={}));

async function l(e){w=await x();const r=[e.geometryBuffer];return {result:j(w,e,r),transferList:r}}async function u(e){w=await x();const r=[e.geometryBuffer],{geometryBuffer:t}=e,o=t.byteLength,n=w._malloc(o),s=new Uint8Array(w.HEAPU8.buffer,n,o);s.set(new Uint8Array(t));const i=w.dracoDecompressPointCloudData(n,s.byteLength);if(w._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&r.push(a.buffer),r.push(f.buffer),{result:{positions:f,featureIds:a},transferList:r}}async function m(e){await x(),L(e);const r={buffer:e.buffer};return {result:r,transferList:[r.buffer]}}async function y(e){await x(),E(e);}async function p(e){w=await x(),w.setLegacySchema(e.context,e.jsonSchema);}async function d(e){const{localMatrix:s,origin:i,positions:a,vertexSpace:f,localMode:c}=e,l=f$1.fromJSON(e.inSpatialReference),u=f$1.fromJSON(e.outSpatialReference);let m;const[{projectBuffer:y},{initializeProjection:p}]=await Promise.all([__vitePreload(() => import('./main-5ivotA7d.js').then(n => n.r9),true?__vite__mapDeps([1,2,3]):void 0,import.meta.url),__vitePreload(() => import('./main-5ivotA7d.js').then(n => n.ra),true?__vite__mapDeps([1,2,3]):void 0,import.meta.url)]);await p(l,u);const d=[0,0,0];if(!y(i,l,0,d,u,0,1))throw new Error("Failed to project");if("georeferenced"===f.type&&null==f.origin){if(m=new Float64Array(a.length),!y(a,l,0,m,u,0,m.length/3))throw new Error("Failed to project")}else {const e="georeferenced"===f.type?i$1.fromJSON(f):a$1.fromJSON(f),{project:r}=await __vitePreload(async () => { const {project:r} = await import('./projection-o15496_e.js');return {project:r}},true?__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12]):void 0,import.meta.url),i=r({positions:a,transform:s?{localMatrix:s}:void 0,vertexSpace:e,inSpatialReference:l,outSpatialReference:u,localMode:c});if(!i)throw new Error("Failed to project");m=y$1(i);}const b=m.length,[h,g,w]=d;for(let r=0;r<b;r+=3)m[r]-=h,m[r+1]-=g,m[r+2]-=w;return {result:{projected:m,original:a,projectedOrigin:d},transferList:[m.buffer,a.buffer]}}async function b({normalMatrix:r,normals:t}){const o=new Float32Array(t.length);return f(o,t,r),_$1(r)&&l$1(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function h(e){I(e);}let g,w;function E(e){if(!w)return;const r=e.modifications,t=w._malloc(8*r.length),o=new Float64Array(w.HEAPU8.buffer,t,r.length);for(let n=0;n<r.length;++n)o[n]=r[n];w.setModifications(e.context,t,r.length,e.isGeodetic),w._free(t);}function j(e,r,t){const{context:o,globalTrafo:n,mbs:s,obbData:i,elevationOffset:f,geometryBuffer:c,geometryDescriptor:l,indexToVertexProjector:u,vertexToRenderProjector:m}=r,y=e._malloc(c.byteLength),p=33,d=e._malloc(p*Float64Array.BYTES_PER_ELEMENT),b=new Uint8Array(e.HEAPU8.buffer,y,c.byteLength);b.set(new Uint8Array(c));const h=new Float64Array(e.HEAPU8.buffer,d,p);S(h,[NaN,NaN,NaN]);let g=h.byteOffset+3*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g);S(w,n),g+=16*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g),S(w,s),g+=4*h.BYTES_PER_ELEMENT,i&&(w=new Float64Array(h.buffer,g),S(w,i));const E=l,j={isDraco:!1,isLegacy:!1,color:r.layouts.some((e=>e.some((e=>"color"===e.name)))),normal:r.needNormals&&r.layouts.some((e=>e.some((e=>"normalCompressed"===e.name)))),uv0:r.layouts.some((e=>e.some((e=>"uv0"===e.name)))),uvRegion:r.layouts.some((e=>e.some((e=>"uvRegion"===e.name)))),featureIndex:E.featureIndex},A=e.process(o,!!r.obbData,y,b.byteLength,E,j,d,f,u,m,r.normalReferenceFrame);if(e._free(d),e._free(y),A.error.length>0)throw new Error(`i3s.wasm: ${A.error}`);if(A.discarded)return null;const L=A.componentOffsets.length>0?A.componentOffsets.slice():null,I=A.featureIds.length>0?A.featureIds.slice():null,_=A.anchorIds.length>0?Array.from(A.anchorIds):null,x=A.anchors.length>0?Array.from(A.anchors):null,M=A.interleavedVertedData.slice().buffer,N=A.indicesType===n$1.Int16?new Uint16Array(A.indices.buffer,A.indices.byteOffset,A.indices.byteLength/2).slice():new Uint32Array(A.indices.buffer,A.indices.byteOffset,A.indices.byteLength/4).slice(),P=A.positions.slice(),U=A.positionIndicesType===n$1.Int16?new Uint16Array(A.positionIndices.buffer,A.positionIndices.byteOffset,A.positionIndices.byteLength/2).slice():new Uint32Array(A.positionIndices.buffer,A.positionIndices.byteOffset,A.positionIndices.byteLength/4).slice(),T={layout:r.layouts[0],interleavedVertexData:M,indices:N,hasColors:A.hasColors,hasModifications:A.hasModifications,positionData:{data:P,indices:U}};return I&&t.push(I.buffer),L&&t.push(L.buffer),t.push(M),t.push(N.buffer),t.push(P.buffer),t.push(U.buffer),{componentOffsets:L,featureIds:I,anchorIds:_,anchors:x,transformedGeometry:T,obb:A.obb,globalTrafo:n}}function A(e){return 0===e?r.Unmodified:1===e?r.PotentiallyModified:2===e?r.Culled:r.Unknown}function L(e){if(!w)return;const{context:r,buffer:t}=e,o=w._malloc(t.byteLength),n=t.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(w.HEAPU8.buffer,o,n),i=new Float64Array(t);s.set(i),w.filterOBBs(r,o,n),i.set(s),w._free(o);}function I(e){w&&0===w.destroy(e)&&(w=null);}function S(e,r){for(let t=0;t<r.length;++t)e[t]=r[t];}async function _(){w||await x();}function x(){return w?Promise.resolve(w):(g||(g=e().then((e=>(w=e,g=null,w)))),g)}const M={transform:(e,r)=>w&&j(w,e,r),destroy:I};

export { h as destroyContext, u as dracoDecompressPointCloudData, m as filterObbsForModifications, L as filterObbsForModificationsSync, _ as initialize, A as interpretObbModificationResults, l as process, d as project, p as setLegacySchema, y as setModifications, E as setModificationsSync, M as test, b as transformNormals };
