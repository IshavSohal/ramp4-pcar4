{"version":3,"file":"index-DzMdzRrO.js","sources":["../../src/fixtures/grid/api/grid.ts","../../src/fixtures/grid/lang/lang.csv?raw","../../src/fixtures/grid/index.ts"],"sourcesContent":["import { FixtureInstance } from '@/api';\r\nimport { useGridStore, type MergeGridConfig } from '../store';\r\nimport TableStateManager from '../store/table-state-manager';\r\n\r\nexport class GridAPI extends FixtureInstance {\r\n    private gridStore = useGridStore(this.$vApp.$pinia);\r\n    /**\r\n     * Open the grid with the given id.\r\n     *\r\n     * @param {string} id\r\n     * @param {boolean} [open] force panel open or closed\r\n     * @memberof GridAPI\r\n     */\r\n    toggleGrid(id: string, open?: boolean): void {\r\n        // fetch id of grid containing layer with given id\r\n        const gridId = this.gridStore.getGridId(id);\r\n\r\n        // if no GridConfig exists for the given id, create it.\r\n        if (!gridId) {\r\n            const layerGridConfigs: any = this.getLayerFixtureConfigs();\r\n\r\n            this.gridStore.addGrid({\r\n                id: id,\r\n                layerIds: [id],\r\n                state: new TableStateManager(layerGridConfigs[id]),\r\n                fieldMap: {}\r\n            });\r\n        }\r\n\r\n        const prevId = this.gridStore.currentId;\r\n        this.gridStore.currentId = gridId ?? id;\r\n\r\n        const panel = this.$iApi.panel.get('grid');\r\n\r\n        if (open === false) {\r\n            // force close\r\n            panel.close();\r\n            return;\r\n        }\r\n\r\n        if (!panel.isOpen || !panel.isVisible) {\r\n            this.$iApi.panel.open('grid');\r\n        } else if (prevId !== id || open === true) {\r\n            // don't toggle off if different layer or force open, use key prop to force rerender\r\n            panel.show({ screen: 'grid-screen', props: { key: id } });\r\n        } else {\r\n            panel.close();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Parses the grid config JSON snippet from the config file.\r\n     *\r\n     * @param {any} config\r\n     * @memberof GridAPI\r\n     */\r\n    _parseConfig(config?: { mergeGrids: MergeGridConfig[] }) {\r\n        this.handlePanelWidths(['grid']);\r\n        this.handlePanelTeleports(['grid']);\r\n\r\n        const layerGridConfigs: any = this.getLayerFixtureConfigs();\r\n\r\n        // parse merge grid configs\r\n        if (config && config.mergeGrids) {\r\n            config.mergeGrids.forEach((mergeGrid: any) => {\r\n                const layerIds: string[] = [];\r\n\r\n                // extract grid options\r\n                const { gridId, layers, fieldMap, options } = mergeGrid;\r\n\r\n                // collate merged layer ids and remove them from layer specific grid configs\r\n                // in case they are defined in two places\r\n                layers.forEach((layer: any) => {\r\n                    if (layer.sublayers) {\r\n                        layer.sublayers?.forEach((sl: number) => {\r\n                            layerIds.push(`${layer.layerId}-${sl}`);\r\n                            delete layerGridConfigs[`${layer.layerId}-${sl}`];\r\n                        });\r\n                    } else {\r\n                        layerIds.push(layer.layerId);\r\n                        delete layerGridConfigs[layer.layerId];\r\n                    }\r\n                });\r\n\r\n                const mapping: { [source: string]: string } = {};\r\n                fieldMap?.forEach((map: any) => {\r\n                    map.sources.forEach((source: string) => {\r\n                        mapping[source] = map.field;\r\n                    });\r\n                });\r\n\r\n                const gridConfig = {\r\n                    id: gridId,\r\n                    layerIds: layerIds,\r\n                    state: new TableStateManager(options),\r\n                    fieldMap: mapping\r\n                };\r\n                this.gridStore.addGrid(gridConfig);\r\n            });\r\n        }\r\n\r\n        // construct the details config from the layer fixture configs\r\n        Object.keys(layerGridConfigs).forEach((layerId: string) => {\r\n            const gridConfig = {\r\n                id: layerId,\r\n                layerIds: [layerId],\r\n                state: new TableStateManager(layerGridConfigs[layerId]),\r\n                fieldMap: {}\r\n            };\r\n\r\n            // save the item in the store\r\n            this.gridStore.addGrid(gridConfig);\r\n        });\r\n    }\r\n}\r\n","export default \"key,enValue,enValid,frValue,frValid\\r\\ngrid.title,Datatable,1,Tableau de données,1\\r\\ngrid.alertName,Grid,1,Grille,1\\r\\ngrid.splash.error,Error: Failed to load the layer's data.,1,Erreur : Échec du chargement des données de la couche.,0\\r\\ngrid.splash.loading,Loading data...,1,Chargement des données...,1\\r\\ngrid.splash.building,Building table...,1,Création du tableau...,1\\r\\ngrid.splash.cancel,Cancel,1,Annuler,1\\r\\ngrid.clearAll,Clear search and filters,1,Effacer la recherche et les filtres,1\\r\\ngrid.layer.loading,The layer is loading...,1,La couche est en cours de téléchargement...,1\\r\\ngrid.label.pinColumns,Pin columns,1,Épingler les colonnes,1\\r\\ngrid.label.export,Export,1,Exporter,1\\r\\ngrid.label.columns,Hide columns,1,Masquer les colonnes,1\\r\\ngrid.label.copied,Copied,1,Copié,1\\r\\ngrid.label.copy,Press ctrl + c or double click to copy,1,Appuyez sur Ctrl + C ou double-cliquez pour copier,1\\r\\ngrid.label.specialColumn,Special Column,1,Colonne spéciale,0\\r\\ngrid.label.filters.show,Show filters,1,Afficher les filtres,1\\r\\ngrid.label.filters.hide,Hide filters,1,Masquer les filtres,1\\r\\ngrid.label.filters.apply,Apply filters to map,1,Appliquer les filtres à la carte,1\\r\\ngrid.header.sort.0,Sort ascending,1,Tri ascendant,1\\r\\ngrid.header.sort.1,Sort descending,1,Tri descendant,1\\r\\ngrid.header.sort.2,Sort default,1,Tri par défaut,1\\r\\ngrid.header.reorder.left,Move left,1,Déplacer vers la gauche,1\\r\\ngrid.header.reorder.right,Move right,1,Déplacer vers la droite,1\\r\\ngrid.filters.label.global,Search table,1,Tableau de recherche,1\\r\\ngrid.filters.column.label.text,Search {0}...,1,Rechercher {0}...,1\\r\\ngrid.filters.clear,Clear filters,1,Supprimer les filtres,1\\r\\ngrid.filters.number.max,Max,1,Max,1\\r\\ngrid.filters.number.min,Min,1,Min,1\\r\\ngrid.filters.date.max,Max Date,1,Date max,1\\r\\ngrid.filters.date.min,Min Date,1,Date min,1\\r\\ngrid.filters.label.info,{range} of {total} entries shown,1,{range} de {total} saisies affichées,1\\r\\ngrid.filters.label.filtered,(filtered from {max} total entries),1,(filtré à partir d'un total de {max} saisies),1\\r\\ngrid.filters.label.extent,Filter by extent,1,Filtrer par étendue,1\\r\\ngrid.cells.controls,Use arrow keys to navigate grid cells. Press Tab to proceed,1,Utilisez les flèches pour parcourir les cellules de la grille. Appuyez sur Tab pour continuer,0\\r\\ngrid.cells.zoom,Zoom to feature,1,Zoom à l'élément,1\\r\\ngrid.cells.zoom.zooming,Zooming...,1,Zoom en cours...,1\\r\\ngrid.cells.zoom.error,Zoom failed,1,Échec du zoom,1\\r\\ngrid.cells.zoom.zoomed,Zoomed,1,Zoom terminé,1\\r\\ngrid.cells.alert.zoom,Zoomed into feature,1,Zoom sur la caractéristique,1\\r\\ngrid.cells.details,Details,1,Détails,1\\r\\ngrid.button.title,Grid,1,Grille,1\"","import { GridAPI } from './api/grid';\r\nimport { markRaw } from 'vue';\r\n\r\nimport messages from './lang/lang.csv?raw';\r\nimport { useAppbarStore } from '../appbar/store';\r\nimport { useGridStore } from './store';\r\n\r\nclass GridFixture extends GridAPI {\r\n    async added() {\r\n        this.$iApi.panel.register(\r\n            {\r\n                grid: {\r\n                    screens: {\r\n                        'grid-screen': () => markRaw(import('./screen.vue'))\r\n                    },\r\n                    style: {\r\n                        width: '450px'\r\n                    },\r\n                    controls: {\r\n                        expand: true\r\n                    },\r\n                    button: {\r\n                        tooltip: 'grid.button.title',\r\n                        // https://fonts.google.com/icons?selected=Material%20Icons%3Atable_chart\r\n                        icon: '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\" /> <path d=\"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5v11zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2zM3 19c0 1.1.9 2 2 2h3V10H3v9z\" /></svg>'\r\n                    },\r\n                    expanded: true,\r\n                    alertName: 'grid.alertName'\r\n                }\r\n            },\r\n            { i18n: { messages } }\r\n        );\r\n\r\n        // parse grid config for each layer\r\n        this._parseConfig(this.config);\r\n    }\r\n\r\n    removed() {\r\n        if (this.$iApi.fixture.exists('appbar')) {\r\n            const appbarStore = useAppbarStore(this.$vApp.$pinia);\r\n            appbarStore.removeButton('grid');\r\n        }\r\n\r\n        const gridStore = useGridStore(this.$vApp.$pinia);\r\n        gridStore.$reset();\r\n\r\n        this.$iApi.panel.remove('grid');\r\n    }\r\n}\r\n\r\nexport default GridFixture;\r\n"],"names":["GridAPI","FixtureInstance","useGridStore","id","open","gridId","layerGridConfigs","TableStateManager","prevId","panel","config","mergeGrid","layerIds","layers","fieldMap","options","layer","sl","mapping","map","source","gridConfig","layerId","messages","GridFixture","markRaw","useAppbarStore"],"mappings":";;AAIO,MAAMA,UAAgBC,EAAgB;AAAA,EACjC,YAAYC,EAAa,KAAK,MAAM,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQlD,WAAWC,GAAYC,GAAsB;AAEzC,UAAMC,IAAS,KAAK,UAAU,UAAUF,CAAE;AAG1C,QAAI,CAACE,GAAQ;AACH,YAAAC,IAAwB,KAAK,uBAAuB;AAE1D,WAAK,UAAU,QAAQ;AAAA,QACnB,IAAAH;AAAA,QACA,UAAU,CAACA,CAAE;AAAA,QACb,OAAO,IAAII,EAAkBD,EAAiBH,CAAE,CAAC;AAAA,QACjD,UAAU,CAAA;AAAA,MAAC,CACd;AAAA,IAAA;AAGC,UAAAK,IAAS,KAAK,UAAU;AACzB,SAAA,UAAU,YAAYH,KAAUF;AAErC,UAAMM,IAAQ,KAAK,MAAM,MAAM,IAAI,MAAM;AAEzC,QAAIL,MAAS,IAAO;AAEhB,MAAAK,EAAM,MAAM;AACZ;AAAA,IAAA;AAGJ,IAAI,CAACA,EAAM,UAAU,CAACA,EAAM,YACnB,KAAA,MAAM,MAAM,KAAK,MAAM,IACrBD,MAAWL,KAAMC,MAAS,KAE3BK,EAAA,KAAK,EAAE,QAAQ,eAAe,OAAO,EAAE,KAAKN,EAAG,GAAG,IAExDM,EAAM,MAAM;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASJ,aAAaC,GAA4C;AAChD,SAAA,kBAAkB,CAAC,MAAM,CAAC,GAC1B,KAAA,qBAAqB,CAAC,MAAM,CAAC;AAE5B,UAAAJ,IAAwB,KAAK,uBAAuB;AAGtD,IAAAI,KAAUA,EAAO,cACVA,EAAA,WAAW,QAAQ,CAACC,MAAmB;AAC1C,YAAMC,IAAqB,CAAC,GAGtB,EAAE,QAAAP,GAAQ,QAAAQ,GAAQ,UAAAC,GAAU,SAAAC,EAAY,IAAAJ;AAIvC,MAAAE,EAAA,QAAQ,CAACG,MAAe;AAC3B,QAAIA,EAAM,YACAA,EAAA,WAAW,QAAQ,CAACC,MAAe;AACrC,UAAAL,EAAS,KAAK,GAAGI,EAAM,OAAO,IAAIC,CAAE,EAAE,GACtC,OAAOX,EAAiB,GAAGU,EAAM,OAAO,IAAIC,CAAE,EAAE;AAAA,QAAA,CACnD,KAEQL,EAAA,KAAKI,EAAM,OAAO,GACpB,OAAAV,EAAiBU,EAAM,OAAO;AAAA,MACzC,CACH;AAED,YAAME,IAAwC,CAAC;AACrC,MAAAJ,GAAA,QAAQ,CAACK,MAAa;AACxB,QAAAA,EAAA,QAAQ,QAAQ,CAACC,MAAmB;AAC5B,UAAAF,EAAAE,CAAM,IAAID,EAAI;AAAA,QAAA,CACzB;AAAA,MAAA,CACJ;AAED,YAAME,IAAa;AAAA,QACf,IAAIhB;AAAA,QACJ,UAAAO;AAAA,QACA,OAAO,IAAIL,EAAkBQ,CAAO;AAAA,QACpC,UAAUG;AAAA,MACd;AACK,WAAA,UAAU,QAAQG,CAAU;AAAA,IAAA,CACpC,GAIL,OAAO,KAAKf,CAAgB,EAAE,QAAQ,CAACgB,MAAoB;AACvD,YAAMD,IAAa;AAAA,QACf,IAAIC;AAAA,QACJ,UAAU,CAACA,CAAO;AAAA,QAClB,OAAO,IAAIf,EAAkBD,EAAiBgB,CAAO,CAAC;AAAA,QACtD,UAAU,CAAA;AAAA,MACd;AAGK,WAAA,UAAU,QAAQD,CAAU;AAAA,IAAA,CACpC;AAAA,EAAA;AAET;AClHA,MAAAE,IAAe,EAAC,IAAK,EAAC,cAAa,aAAY,kBAAiB,QAAO,qBAAoB,2CAA0C,uBAAsB,mBAAkB,wBAAuB,qBAAoB,sBAAqB,UAAS,iBAAgB,4BAA2B,sBAAqB,2BAA0B,yBAAwB,eAAc,qBAAoB,UAAS,sBAAqB,gBAAe,qBAAoB,UAAS,mBAAkB,0CAAyC,4BAA2B,kBAAiB,2BAA0B,gBAAe,2BAA0B,gBAAe,4BAA2B,wBAAuB,sBAAqB,kBAAiB,sBAAqB,mBAAkB,sBAAqB,gBAAe,4BAA2B,aAAY,6BAA4B,cAAa,6BAA4B,gBAAe,kCAAiC,iBAAgB,sBAAqB,iBAAgB,2BAA0B,OAAM,2BAA0B,OAAM,yBAAwB,YAAW,yBAAwB,YAAW,2BAA0B,oCAAmC,+BAA8B,uCAAsC,6BAA4B,oBAAmB,uBAAsB,+DAA8D,mBAAkB,mBAAkB,2BAA0B,cAAa,yBAAwB,eAAc,0BAAyB,UAAS,yBAAwB,uBAAsB,sBAAqB,WAAU,qBAAoB,OAAM,GAAE,IAAK,EAAC,cAAa,sBAAqB,kBAAiB,UAAS,qBAAoB,0DAAyD,uBAAsB,6BAA4B,wBAAuB,0BAAyB,sBAAqB,WAAU,iBAAgB,uCAAsC,sBAAqB,+CAA8C,yBAAwB,yBAAwB,qBAAoB,YAAW,sBAAqB,wBAAuB,qBAAoB,SAAQ,mBAAkB,sDAAqD,4BAA2B,oBAAmB,2BAA0B,wBAAuB,2BAA0B,uBAAsB,4BAA2B,oCAAmC,sBAAqB,iBAAgB,sBAAqB,kBAAiB,sBAAqB,kBAAiB,4BAA2B,2BAA0B,6BAA4B,2BAA0B,6BAA4B,wBAAuB,kCAAiC,qBAAoB,sBAAqB,yBAAwB,2BAA0B,OAAM,2BAA0B,OAAM,yBAAwB,YAAW,yBAAwB,YAAW,2BAA0B,wCAAuC,+BAA8B,iDAAgD,6BAA4B,uBAAsB,uBAAsB,iGAAgG,mBAAkB,oBAAmB,2BAA0B,oBAAmB,yBAAwB,iBAAgB,0BAAyB,gBAAe,yBAAwB,+BAA8B,sBAAqB,WAAU,qBAAoB,SAAQ,EAAC;ACO7/G,MAAMC,UAAoBxB,EAAQ;AAAA,EAC9B,MAAM,QAAQ;AACV,SAAK,MAAM,MAAM;AAAA,MACb;AAAA,QACI,MAAM;AAAA,UACF,SAAS;AAAA,YACL,eAAe,MAAMyB,EAAQ,OAAO,sBAAc,CAAC;AAAA,UACvD;AAAA,UACA,OAAO;AAAA,YACH,OAAO;AAAA,UACX;AAAA,UACA,UAAU;AAAA,YACN,QAAQ;AAAA,UACZ;AAAA,UACA,QAAQ;AAAA,YACJ,SAAS;AAAA;AAAA,YAET,MAAM;AAAA,UACV;AAAA,UACA,UAAU;AAAA,UACV,WAAW;AAAA,QAAA;AAAA,MAEnB;AAAA,MACA,EAAE,MAAM,EAAE,UAAAF,EAAW,EAAA;AAAA,IACzB,GAGK,KAAA,aAAa,KAAK,MAAM;AAAA,EAAA;AAAA,EAGjC,UAAU;AACN,IAAI,KAAK,MAAM,QAAQ,OAAO,QAAQ,KACdG,EAAe,KAAK,MAAM,MAAM,EACxC,aAAa,MAAM,GAGjBxB,EAAa,KAAK,MAAM,MAAM,EACtC,OAAO,GAEZ,KAAA,MAAM,MAAM,OAAO,MAAM;AAAA,EAAA;AAEtC;"}