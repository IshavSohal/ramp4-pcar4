{"version":3,"file":"screen.vue_vue_type_script_setup_true_lang-CZEWImwL.js","sources":["../../src/fixtures/export/settings-button.vue","../../src/fixtures/export/screen.vue"],"sourcesContent":["<template>\r\n    <dropdown-menu v-focus-item :position=\"dropdownPlacement\" :tooltip=\"t('export.menu')\" tooltipPlacement=\"top\">\r\n        <template #header>\r\n            <div class=\"flex items-center text-gray-400 w-full h-full hover:text-black p-4 sm:p-8\">\r\n                <svg class=\"fill-current w-24 h-24 m-auto\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\r\n                    <g>\r\n                        <path d=\"M0,0h24v24H0V0z\" fill=\"none\" />\r\n                        <path\r\n                            d=\"M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z\"\r\n                        />\r\n                    </g>\r\n                </svg>\r\n            </div>\r\n        </template>\r\n        <template v-slot:default>\r\n            <a\r\n                v-for=\"component in componentSelectedState\"\r\n                :key=\"component.name\"\r\n                @click=\"toggleComponent(component)\"\r\n                href=\"javascript:;\"\r\n                :class=\"`text-left text-sm sm:text-base ${component.selectable ? 'cursor-pointer' : 'cursor-default'}`\"\r\n                :aria-label=\"component.name\"\r\n            >\r\n                <div class=\"md-icon-small inline\">\r\n                    <svg\r\n                        height=\"20\"\r\n                        width=\"20\"\r\n                        viewBox=\"0 0 24 24\"\r\n                        :class=\"`inline mx-8 ${!component.selected ? 'invisible' : ''}`\"\r\n                    >\r\n                        <g>\r\n                            <path d=\"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z\" />\r\n                        </g>\r\n                    </svg>\r\n                    <span\r\n                        :class=\"`inline ${!component.selectable ? 'text-gray-300' : ''}\r\n                    `\"\r\n                        >{{ t(`export.menu.component.${component.name}`) }}</span\r\n                    >\r\n                </div>\r\n            </a>\r\n        </template>\r\n    </dropdown-menu>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { usePanelStore } from '@/stores/panel';\r\nimport { useExportStore } from './store';\r\n\r\nconst { t } = useI18n();\r\nconst panelStore = usePanelStore();\r\nconst exportStore = useExportStore();\r\n\r\ndefineProps({\r\n    componentSelectedState: {\r\n        type: Object,\r\n        required: true\r\n    }\r\n});\r\n\r\nconst dropdownPlacement = computed<string>(() => (panelStore.mobileView ? 'top-end' : 'left-end'));\r\n\r\nconst toggleComponent = (component: any): void => {\r\n    if (!component.selectable) {\r\n        return;\r\n    }\r\n    // update the store\r\n    exportStore.toggleSelected({\r\n        name: component.name\r\n    });\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n","<template>\r\n    <panel-screen :panel=\"panel\" :footer=\"true\">\r\n        <template #header> {{ t('export.title') }} </template>\r\n\r\n        <template #content>\r\n            <div class=\"overflow-hidden border border-gray-200\" ref=\"componentEl\">\r\n                <canvas class=\"export-canvas !w-[100%]\"></canvas>\r\n            </div>\r\n        </template>\r\n\r\n        <template #footer>\r\n            <div class=\"flex\">\r\n                <button\r\n                    type=\"button\"\r\n                    @click=\"fixture?.export()\"\r\n                    class=\"bg-green-700 hover:bg-green-800 text-white font-bold py-8 px-4 sm:px-16 mr-8 sm:mr-16\"\r\n                    :aria-label=\"t('export.download')\"\r\n                >\r\n                    {{ t('export.download') }}\r\n                </button>\r\n\r\n                <button type=\"button\" @click=\"make()\" class=\"py-8 px-4 sm:px-16\" :aria-label=\"t('export.refresh')\">\r\n                    {{ t('export.refresh') }}\r\n                </button>\r\n\r\n                <export-settings\r\n                    v-if=\"!hasCustomRenderer\"\r\n                    :componentSelectedState=\"selectedComponents\"\r\n                    class=\"ml-auto flex px-4 sm:px-8\"\r\n                ></export-settings>\r\n            </div>\r\n        </template>\r\n    </panel-screen>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, inject, onBeforeMount, onBeforeUnmount, onMounted, ref, useTemplateRef, watch } from 'vue';\r\nimport type { PropType } from 'vue';\r\nimport type { InstanceAPI, PanelInstance } from '@/api';\r\nimport type { ExportAPI } from './api/export';\r\n\r\nimport { debounce } from 'throttle-debounce';\r\n\r\nimport ExportSettings from './settings-button.vue';\r\nimport { useExportStore } from './store';\r\nimport { useI18n } from 'vue-i18n';\r\n\r\nconst props = defineProps({\r\n    panel: {\r\n        type: Object as PropType<PanelInstance>,\r\n        required: true\r\n    }\r\n});\r\n\r\nconst { t } = useI18n();\r\nconst iApi = inject<InstanceAPI>('iApi')!;\r\nconst exportStore = useExportStore();\r\n\r\nconst fixture = ref<ExportAPI>();\r\n\r\n// we need two resize observers, one for the root element and one for the panel since the panel can resize independently of the root (another panel was closed/opened)\r\n// changes to the root element impact map boundaries, changes to the panel impact the resolution of the displayed export\r\nconst rootResizeObserver = ref<ResizeObserver | undefined>(undefined);\r\nconst panelResizeObserver = ref<ResizeObserver | undefined>(undefined);\r\nconst watchers = ref<Array<Function>>([]);\r\n\r\nconst el = useTemplateRef('componentEl');\r\nconst componentSelectedState = computed(() => exportStore.componentSelectedState);\r\nconst selectedComponents = computed<any>(() => {\r\n    let state: any = {};\r\n    if (fixture.value) {\r\n        Object.keys(componentSelectedState.value).forEach((component: string) => {\r\n            state[component] = {\r\n                name: component,\r\n                selected:\r\n                    componentSelectedState.value[\r\n                        component as 'title' | 'map' | 'mapElements' | 'legend' | 'footnote' | 'timestamp'\r\n                    ] ?? false,\r\n                selectable: (fixture.value?.config as any)[component]?.selectable ?? true\r\n            };\r\n        });\r\n    }\r\n    return state;\r\n});\r\n\r\nconst hasCustomRenderer = computed(() => {\r\n    return !!fixture.value?.customRendererFunc;\r\n});\r\n\r\nconst make = debounce(300, () => {\r\n    if (!fixture.value || !el.value) {\r\n        return;\r\n    }\r\n\r\n    const canvasElement = el.value!.querySelector('.export-canvas') as HTMLCanvasElement;\r\n\r\n    fixture.value.make(canvasElement, el.value!.clientWidth);\r\n});\r\n\r\nonBeforeMount(() => {\r\n    (props.panel as any).exportMake = make;\r\n    // Set up watchers\r\n    watchers.value.push(\r\n        // Listen for any changes to the settings, and refresh the image when they do change\r\n        watch(selectedComponents, () => {\r\n            make();\r\n        })\r\n    );\r\n});\r\n\r\nonMounted(() => {\r\n    fixture.value = iApi.fixture.get('export') as ExportAPI;\r\n    rootResizeObserver.value = new ResizeObserver(make);\r\n    panelResizeObserver.value = new ResizeObserver(make);\r\n    // observe the root element for resize events, not the component itself\r\n    rootResizeObserver.value.observe(iApi.$rootEl);\r\n    panelResizeObserver.value.observe(iApi.$rootEl.querySelector('[data-cy=\"export\"]')!);\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n    // remove the resize observer\r\n    rootResizeObserver.value!.disconnect();\r\n    panelResizeObserver.value!.disconnect();\r\n    // remove the watchers\r\n    watchers.value.forEach(unwatch => unwatch());\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["t","useI18n","panelStore","usePanelStore","exportStore","useExportStore","dropdownPlacement","computed","toggleComponent","component","props","__props","iApi","inject","fixture","ref","rootResizeObserver","panelResizeObserver","watchers","el","useTemplateRef","componentSelectedState","selectedComponents","state","hasCustomRenderer","make","debounce","canvasElement","onBeforeMount","watch","onMounted","onBeforeUnmount","unwatch"],"mappings":";;;;;;;;;;AAmDM,UAAA,EAAE,GAAAA,EAAE,IAAIC,EAAQ,GAChBC,IAAaC,EAAc,GAC3BC,IAAcC,EAAe,GAS7BC,IAAoBC,EAAiB,MAAOL,EAAW,aAAa,YAAY,UAAW,GAE3FM,IAAkB,CAACC,MAAyB;AAC1C,MAACA,EAAU,cAIfL,EAAY,eAAe;AAAA,QACvB,MAAMK,EAAU;AAAA,MAAA,CACnB;AAAA,IACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzBA,UAAMC,IAAQC,GAOR,EAAE,GAAAX,EAAE,IAAIC,EAAQ,GAChBW,IAAOC,EAAoB,MAAM,GACjCT,IAAcC,EAAe,GAE7BS,IAAUC,EAAe,GAIzBC,IAAqBD,EAAgC,MAAS,GAC9DE,IAAsBF,EAAgC,MAAS,GAC/DG,IAAWH,EAAqB,EAAE,GAElCI,IAAKC,EAAe,aAAa,GACjCC,IAAyBd,EAAS,MAAMH,EAAY,sBAAsB,GAC1EkB,IAAqBf,EAAc,MAAM;AAC3C,UAAIgB,IAAa,CAAC;AAClB,aAAIT,EAAQ,SACR,OAAO,KAAKO,EAAuB,KAAK,EAAE,QAAQ,CAACZ,MAAsB;AACrE,QAAAc,EAAMd,CAAS,IAAI;AAAA,UACf,MAAMA;AAAA,UACN,UACIY,EAAuB,MACnBZ,CACJ,KAAK;AAAA,UACT,aAAaK,EAAQ,OAAO,QAAeL,CAAS,GAAG,cAAc;AAAA,QACzE;AAAA,MAAA,CACH,GAEEc;AAAA,IAAA,CACV,GAEKC,IAAoBjB,EAAS,MACxB,CAAC,CAACO,EAAQ,OAAO,kBAC3B,GAEKW,IAAOC,EAAS,KAAK,MAAM;AAC7B,UAAI,CAACZ,EAAQ,SAAS,CAACK,EAAG;AACtB;AAGJ,YAAMQ,IAAgBR,EAAG,MAAO,cAAc,gBAAgB;AAE9D,MAAAL,EAAQ,MAAM,KAAKa,GAAeR,EAAG,MAAO,WAAW;AAAA,IAAA,CAC1D;AAED,WAAAS,EAAc,MAAM;AACf,MAAAlB,EAAM,MAAc,aAAae,GAElCP,EAAS,MAAM;AAAA;AAAA,QAEXW,EAAMP,GAAoB,MAAM;AACvB,UAAAG,EAAA;AAAA,QACR,CAAA;AAAA,MACL;AAAA,IAAA,CACH,GAEDK,EAAU,MAAM;AACZ,MAAAhB,EAAQ,QAAQF,EAAK,QAAQ,IAAI,QAAQ,GACtBI,EAAA,QAAQ,IAAI,eAAeS,CAAI,GAC9BR,EAAA,QAAQ,IAAI,eAAeQ,CAAI,GAEhCT,EAAA,MAAM,QAAQJ,EAAK,OAAO,GAC7CK,EAAoB,MAAM,QAAQL,EAAK,QAAQ,cAAc,oBAAoB,CAAE;AAAA,IAAA,CACtF,GAEDmB,EAAgB,MAAM;AAElB,MAAAf,EAAmB,MAAO,WAAW,GACrCC,EAAoB,MAAO,WAAW,GAEtCC,EAAS,MAAM,QAAQ,CAAWc,MAAAA,EAAA,CAAS;AAAA,IAAA,CAC9C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}