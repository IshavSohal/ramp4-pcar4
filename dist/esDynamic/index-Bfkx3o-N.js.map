{"version":3,"file":"index-Bfkx3o-N.js","sources":["../../src/fixtures/panguard/lang/lang.csv?raw","../../src/fixtures/panguard/map-panguard.vue","../../src/fixtures/panguard/index.ts"],"sourcesContent":["export default \"key,enValue,enValid,frValue,frValid\\r\\npanguard.instructions,Use two fingers to pan the map,1,Utilisez deux doigts pour faire un panoramique de la carte,1\\r\\n\"","<template>\r\n    <div class=\"pg\" ref=\"panGuard\">\r\n        <p class=\"pg-label\">{{ t('panguard.instructions') }}</p>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { inject, onBeforeUnmount, onMounted, reactive, ref } from 'vue';\r\nimport { GlobalEvents, InstanceAPI } from '@/api';\r\nimport { useI18n } from 'vue-i18n';\r\n\r\nconst { t } = useI18n();\r\nconst iApi = inject('iApi') as InstanceAPI;\r\nconst panGuard = ref<HTMLElement>();\r\n\r\nconst timeoutID = ref(-1);\r\nconst esriHandlers = reactive<Array<any>>([]);\r\nconst rampHanders = reactive<Array<string>>([]);\r\n\r\nonMounted(() => {\r\n    setup();\r\n    // setup again when the map reloads\r\n    rampHanders.push(\r\n        iApi.event.on(GlobalEvents.MAP_CREATED, () => {\r\n            setup();\r\n        })\r\n    );\r\n    rampHanders.push(\r\n        iApi.event.on(GlobalEvents.MAP_DESTROYED, () => {\r\n            esriHandlers.forEach(h => h.remove());\r\n        })\r\n    );\r\n    rampHanders.push(\r\n        iApi.event.on(GlobalEvents.MAP_REFRESH_START, () => {\r\n            esriHandlers.forEach(h => h.remove());\r\n        })\r\n    );\r\n    rampHanders.push(\r\n        iApi.event.on(GlobalEvents.MAP_REFRESH_END, () => {\r\n            setup();\r\n        })\r\n    );\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n    rampHanders.forEach(h => iApi.event.off(h));\r\n    esriHandlers.forEach(h => h.remove());\r\n});\r\n\r\nconst setup = () => {\r\n    // keep track of how many concurrent pointers are on the screen and their initial positions. This is a javascript map, not a map-map\r\n    const pointers = new Map();\r\n\r\n    // prevent possible issues with esri event registration if this fixture runs before the map has built itself\r\n    iApi.geo.map.viewPromise.then(() => {\r\n        esriHandlers.push(\r\n            iApi.geo.map.esriView!.on('pointer-down', e => {\r\n                if (e.pointerType !== 'touch') return;\r\n                pointers.set(e.pointerId, { x: e.x, y: e.y });\r\n            })\r\n        );\r\n\r\n        esriHandlers.push(\r\n            //@ts-ignore\r\n            iApi.geo.map.esriView!.on(['pointer-up', 'pointer-leave'], e => {\r\n                if (e.pointerType !== 'touch') return;\r\n                // small delay as to not offend panguard when lifting more than one finger\r\n                window.setTimeout(() => {\r\n                    pointers.delete(e.pointerId);\r\n                }, 200);\r\n            })\r\n        );\r\n\r\n        esriHandlers.push(\r\n            iApi.geo.map.esriView!.on('pointer-move', e => {\r\n                const { pointerId, pointerType, x, y } = e;\r\n                const pointer = pointers.get(pointerId);\r\n\r\n                if (!pointer || pointerType !== 'touch' || pointers.size !== 1) {\r\n                    panGuard.value!.classList.remove('pg-active');\r\n                    return;\r\n                }\r\n\r\n                // ignore very small movements to avoid scrolling when someone is tapping the screen\r\n                const distance = Math.sqrt(Math.pow(x - pointer.x, 2) + Math.pow(y - pointer.y, 2));\r\n                if (distance < 20) return;\r\n\r\n                // show the text on screen and remove after 2 seconds of no movement\r\n                panGuard.value!.classList.add('pg-active');\r\n\r\n                if (timeoutID.value !== -1) {\r\n                    clearTimeout(timeoutID.value);\r\n                }\r\n\r\n                timeoutID.value = window.setTimeout(() => {\r\n                    panGuard.value!.classList.remove('pg-active');\r\n                }, 2000);\r\n\r\n                // manually scroll the page since scrolling doesn't work when moving over the map\r\n                window.scrollBy(pointer.x - x, pointer.y - y);\r\n            })\r\n        );\r\n    });\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.pg {\r\n    transition: opacity ease-in-out;\r\n    background-color: rgba(0, 0, 0, 0.45);\r\n    text-align: center;\r\n\r\n    position: absolute;\r\n    padding: 0px;\r\n    margin: 0px;\r\n    border-width: 0px;\r\n    width: 100%;\r\n    height: 100%;\r\n    left: 0px;\r\n    top: 0px;\r\n\r\n    transition-duration: 0.8s;\r\n\r\n    opacity: 0;\r\n    pointer-events: none !important;\r\n    z-index: 100;\r\n\r\n    &.pg-active {\r\n        opacity: 1;\r\n        transition-duration: 0.3s;\r\n    }\r\n\r\n    .pg-label {\r\n        font-size: 1em * 1.5;\r\n        color: white;\r\n        position: relative;\r\n        margin: 0;\r\n        top: 50% !important;\r\n        transform: translateY(-50%);\r\n    }\r\n}\r\n</style>\r\n","import messages from './lang/lang.csv?raw';\r\nimport PanguardV from './map-panguard.vue';\r\nimport { FixtureInstance } from '@/api';\r\n\r\nclass PanguardFixture extends FixtureInstance {\r\n    added(): void {\r\n        // console.log(`[fixture] ${this.id} added`);\r\n        // Manually add lang entries to i18n\r\n        Object.entries(messages).forEach(value => (<any>this.$iApi.$i18n).mergeLocaleMessage(...value));\r\n\r\n        const { destroy, el } = this.mount(PanguardV, {\r\n            app: this.$element\r\n        });\r\n        const innerShell = this.$vApp.$el.getElementsByClassName('inner-shell')[0];\r\n        innerShell.appendChild(el.childNodes[0]);\r\n\r\n        // override the removed method here to get access to scope\r\n        this.removed = () => {\r\n            // console.log(`[fixture] ${this.id} removed`);\r\n            destroy();\r\n        };\r\n    }\r\n}\r\n\r\nexport default PanguardFixture;\r\n"],"names":["messages","t","useI18n","iApi","inject","panGuard","ref","timeoutID","esriHandlers","reactive","rampHanders","onMounted","setup","GlobalEvents","h","onBeforeUnmount","pointers","e","pointerId","pointerType","x","y","pointer","PanguardFixture","FixtureInstance","value","destroy","el","PanguardV"],"mappings":"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"}