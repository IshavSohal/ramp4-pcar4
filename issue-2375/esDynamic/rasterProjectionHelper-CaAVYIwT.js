import{bl as K,bm as Pe,b8 as F,bn as L,bo as O,$ as Se,b5 as re,a6 as N,aS as Ne,bp as Ge,s as ke,bq as v,br as C,bs as le,bt as Ee,bu as Te,bv as ve,bw as ce}from"./main-C02UbYD7.js";var U;function $(e,t,i){return!Ge(e,t,i)}function W(e,t,i){const s=$(e,t,i);if(s&&!K())throw new ke("rasterprojectionhelper-project","projection engine is not loaded");return s}(function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"})(U||(U={}));const fe=(e,t,i,s=0)=>{if(i[0]===1)return[0,0];let a=1,n=-1,o=1,l=-1;for(let f=0;f<e.length;f+=2)isNaN(e[f])||(a=a>e[f]?e[f]:a,n=n>e[f]?n:e[f],o=o>e[f+1]?e[f+1]:o,l=l>e[f+1]?l:e[f+1]);const{cols:c,rows:r}=t,u=(n-a)/c/i[0],w=(l-o)/r/i[1],y=2*s;let x=0,m=!1,p=[0,0];for(let f=0;f<c-3;f++){for(let M=0;M<r-3;M++){const g=f*r*2+2*M,h=(e[g]+e[g+4]+e[g+4*r]+e[g+4*r+4])/4,d=(e[g+1]+e[g+5]+e[g+4*r+1]+e[g+4*r+5])/4,R=Math.abs((h-e[g+2*r+2])/u),b=Math.abs((d-e[g+2*r+3])/w);if(R+b>x&&(x=R+b,p=[R,b]),y&&x>y){m=!0;break}}if(m)break}return p},Ce={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},B=32,Y=4,V=Y,Z=new Map,H=new Map,q=500;async function _e(){K()||await Pe()}function ue(e,t,i){return W(e.spatialReference,t),i?ce(t,e.spatialReference,e):ce(e.spatialReference,t,e)}function Q(e,t,i,s=null){const a=e.spatialReference;if(a.equals(t))return e;W(a,t,s);const n=i.center,o=new F({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:a}),l=L(o,t,s),c=k(t);let r;if(l==null||c!=null&&l.width>=c){const u=O(a)/O(t);r={x:e.x*u,y:e.y*u}}else r={x:l.width,y:l.height};return r}function G(e,t=.01){return O(e)?t/O(e):0}function ee(e,t,i=null,s=!0){const a=e.spatialReference;if(a.equals(t))return e;W(a,t,i);const n=L(e,t,i);return s&&n&&xe([e],[n],a,t),n}function xe(e,t,i,s){const a=J(i,!0),n=J(s,!0),o=G(i,q),l=G(s,q);if(o&&a!=null&&n!=null)for(let c=0;c<e.length;c++){const r=t[c];if(!r)continue;const{x:u}=e[c],{x:w}=r;w>=n[1]-l&&Math.abs(u-a[0])<o?r.x-=n[1]-n[0]:w<=n[0]+l&&Math.abs(u-a[1])<o&&(r.x+=n[1]-n[0])}}function ze(e){const{inSR:t,outSR:i,datumTransformation:s,preferPE:a}=e;if(t.equals(i)){const{points:n}=te(e,null);return n}return t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator?Ie(e):W(t,i,s)&&a&&(t.isGeographic||I(t)!=null)?We(e):Le(e)}function Le(e){const{points:t}=te(e,null),{inSR:i,outSR:s,datumTransformation:a}=e,n=t.map(l=>new N(l[0],l[1],i)),o=L(n,s,a);return a&&xe(n,o,i,s),o.map(l=>l?[l.x,l.y]:[NaN,NaN])}function We(e){const{inSR:t,outSR:i,datumTransformation:s}=e,a=I(t),{points:n,mask:o}=te(e,a);if(!t.isGeographic){const c=t.wkid?v.coordsys(t.wkid):v.fromString(t.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,t.wkt2||t.wkt);le.projToGeog(c,n.length,n)}if(s!=null&&s.steps.length){let c;if(i.isGeographic&&(c=n.map(([r])=>r>179.9955?1:r<-179.9955?-1:0)),s.steps.forEach(r=>{const u=r.wkid?v.geogtran(r.wkid):v.fromString(C.PE_TYPE_GEOGTRAN,r.wkt);Ee.geogToGeog(u,n.length,n,null,r.isInverse?C.PE_TRANSFORM_2_TO_1:C.PE_TRANSFORM_1_TO_2)}),c)for(let r=0;r<n.length;r++){const u=c[r],w=n[r][0],y=w>179.9955?1:w<-179.9955?-1:0;u&&y&&u!==y&&(n[r][0]=u>0?w+360:w-360)}}if(!i.isGeographic){const c=I(i,!0),r=c!=null&&c.isEnvelope?[c.bbox[1],c.bbox[3]]:[-90,90];Oe(n,r);const u=i.wkid?v.coordsys(i.wkid):v.fromString(i.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,i.wkt2||i.wkt);le.geogToProj(u,n.length,n)}let l=n;if(o&&n.length!==o.length){l=[];for(let c=0,r=0;c<o.length;c++)o[c]?l.push(n[r++]):l.push([NaN,NaN])}return l}function Ie(e){const{cols:t,rows:i,xres:s,yres:a,usePixelCenter:n,inSR:o,outSR:l}=e;let{xmin:c,ymax:r}=e;n&&(c+=s/2,r-=a/2);const u=[],w=[],y=Math.max(t,i);for(let m=0;m<y;m++){const p=c+s*Math.min(t,m),f=r-a*Math.min(i,m),M=L(new N({x:p,y:f,spatialReference:o}),l);m<=t&&u.push(M.x),m<=i&&w.push(M.y)}const x=[];for(let m=0;m<t;m++)for(let p=0;p<i;p++)x.push([u[m],w[p]]);return x}function I(e,t=!1){let i=e.wkid||e.wkt2||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),Z.has(i)){const o=Z.get(i);return t?o?.gcs:o?.pcs}const s=e.wkid?v.coordsys(e.wkid):v.fromString(e.isGeographic?C.PE_TYPE_GEOGCS:C.PE_TYPE_PROJCS,e.wkt2||e.wkt),a=me(s,G(e,1e-4)),n=me(s,0,!0);return Z.set(i,{pcs:a,gcs:n}),t?n:a}function me(e,t=0,i=!1){const s=Te.generate(e),a=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!s||!a?.length)return null;let n=!1,o=a.find(f=>f.getInclusive()===1&&f.getKind()===1);if(!o){if(o=a.find(f=>f.getInclusive()===1&&f.getKind()===0),!o)return null;n=!0}const l=i?0:(s.getNorthPoleLocation()===2?1:0)|(s.getSouthPoleLocation()===2?2:0),c=s.isPannableRectangle(),r=o.getCoord();if(n)return{isEnvelope:n,isPannable:c,vertices:r,coef:null,bbox:[r[0][0]-t,r[0][1]-t,r[1][0]+t,r[1][1]+t],poleLocation:l};let u=0;const w=[];let[y,x]=r[0],[m,p]=r[0];for(let f=0,M=r.length;f<M;f++){u++,u===M&&(u=0);const[g,h]=r[f],[d,R]=r[u];if(R===h)w.push([g,d,h,R,2]);else{const b=(d-g)/(R-h||1e-4),E=g-b*h;h<R?w.push([b,E,h,R,0]):w.push([b,E,R,h,1])}y=y<g?y:g,x=x<h?x:h,m=m>g?m:g,p=p>h?p:h}return{isEnvelope:!1,isPannable:c,vertices:r,coef:w,bbox:[y,x,m,p],poleLocation:l}}function te(e,t){const i=[],{cols:s,rows:a,xres:n,yres:o,usePixelCenter:l}=e;let{xmin:c,ymax:r}=e;if(l&&(c+=n/2,r-=o/2),t==null){for(let x=0;x<s;x++)for(let m=0;m<a;m++)i.push([c+n*x,r-o*m]);return{points:i}}const u=new Uint8Array(s*a);if(t.isEnvelope){const{bbox:[x,m,p,f]}=t;for(let M=0,g=0;M<s;M++){const h=c+n*M,d=t.isPannable||h>=x&&h<=p;for(let R=0;R<a;R++,g++){const b=r-o*R;d&&b>=m&&b<=f&&(i.push([h,b]),u[g]=1)}}return{points:i,mask:u}}const w=t.coef,y=[];for(let x=0;x<a;x++){const m=r-o*x,p=[],f=[];for(let g=0;g<w.length;g++){const[h,d,R,b,E]=w[g];if(m===R&&R===b)p.push(h),p.push(d),f.push(2),f.push(2);else if(m>=R&&m<=b){const S=h*m+d;p.push(S),f.push(E)}}let M=p;if(p.length>2){let g=f[0]===2?0:f[0],h=p[0];M=[];for(let d=1;d<f.length;d++)f[d]===2&&d!==f.length-1||(f[d]!==g&&(M.push(g===0?Math.min(h,p[d-1]):Math.max(h,p[d-1])),g=f[d],h=p[d]),d===f.length-1&&M.push(f[d]===0?Math.min(h,p[d]):Math.max(h,p[d])));M.sort((d,R)=>d-R)}else p[0]>p[1]&&(M=[p[1],p[0]]);y.push(M)}for(let x=0,m=0;x<s;x++){const p=c+n*x;for(let f=0;f<a;f++,m++){const M=r-o*f,g=y[f];if(g.length===2)p>=g[0]&&p<=g[1]&&(i.push([p,M]),u[m]=1);else if(g.length>2){let h=!1;for(let d=0;d<g.length;d+=2)if(p>=g[d]&&p<=g[d+1]){h=!0;break}h&&(i.push([p,M]),u[m]=1)}}}return{points:i,mask:u}}function Oe(e,t){const[i,s]=t;for(let a=0;a<e.length;a++){const n=e[a][1];(n<i||n>s)&&(e[a]=[NaN,NaN])}}function he(e,t){const i=k(e[0].spatialReference);if(e.length<2||i==null||(t=t??G(e[0].spatialReference),(e=e.filter(l=>l.width>t)).length===1))return e[0];let{xmin:s,xmax:a,ymin:n,ymax:o}=e[0];for(let l=1;l<e.length;l++){const c=e[l];a=c.xmax+i*l,n=Math.min(n,c.ymin),o=Math.max(o,c.ymax)}return new F({xmin:s,xmax:a,ymin:n,ymax:o,spatialReference:e[0].spatialReference})}function ne(e,t,i=null,s=!0){const a=e.spatialReference;if(a.equals(t))return e;const n=ie(e),o=k(a,!0),l=k(t);if(n===0||o==null||l==null){const r=pe(e,t,i,s);if(o==null&&l!=null&&Math.abs(r.width-l)<G(t)&&K()){const u=I(a);if(u!=null&&u.poleLocation===U.None&&e.width<(u.bbox[2]-u.bbox[0])/2)return Ae(e,t)||r}return r}const c=e.clone().normalize();if(c.length===1&&e.xmax<o&&e.xmax-o/2>G(a)){const{xmin:r,xmax:u}=e;for(let w=0;w<=n;w++){const y=w===0?r:-o/2,x=w===n?u-o*w:o/2;c[w]=new F({xmin:y,xmax:x,ymin:e.ymin,ymax:e.ymax,spatialReference:a})}}return he(c.map(r=>pe(r,t,i,s)).filter(Se))}function je(e,t,i){if(e.type==="extent"){const{xmin:s,ymin:a,xmax:n,ymax:o,spatialReference:l}=e;e=new re({rings:[[[s,o],[n,o],[n,a],[s,a],[s,o]]],spatialReference:l})}return e.spatialReference.equals(t)?e:(W(e.spatialReference,t,i),L(e,t,i))}function Ae(e,t){const i=k(t);if(i==null)return null;let{xmin:s,ymin:a,xmax:n,ymax:o}=e;const l=e.spatialReference,c=new re({spatialReference:l,rings:[[[s,a],[n,a],[n,o],[s,o],[s,a]]]}),r=L(c,t);if(r.rings.length!==2||!r.rings[0].length||!r.rings[1].length)return null;const{rings:u}=r,w=G(l),y=new F({spatialReference:t});for(let x=0;x<2;x++){s=n=u[x][0][0],a=o=u[x][0][1];for(let m=0;m<u[x].length;m++)s=s>u[x][m][0]?u[x][m][0]:s,n=n<u[x][m][0]?u[x][m][0]:n,a=a>u[x][m][1]?u[x][m][1]:a,o=o<u[x][m][1]?u[x][m][1]:o;if(x===0)y.ymin=a,y.ymax=o,y.xmin=s,y.xmax=n;else if(y.ymin=Math.min(y.ymin,a),y.ymax=Math.max(y.ymax,o),Math.abs(n-i/2)<w)y.xmin=s,y.xmax=y.xmax+i;else{if(!(Math.abs(s+i/2)<w))return null;y.xmax=n+i}}return y}function pe(e,t,i=null,s=!0,a=!0){const n=e.spatialReference;if(n.equals(t)||!t)return e;W(n,t,i);const o=L(e,t,i);if(a&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508342787e-6,o.ymax),o.ymin=Math.max(-20037508342787e-6,o.ymin),o.ymin>=o.ymax))return null;if(!s||!o)return o;const l=J(n,!0),c=J(t,!0);if(l==null||c==null)return o;const r=G(n,.001),u=G(n,q),w=G(t,.001);if(Math.abs(o.xmin-c[0])<w&&Math.abs(o.xmax-c[1])<w){const y=Math.abs(e.xmin-l[0]),x=Math.abs(l[1]-e.xmax);if(y<r&&x>u){o.xmin=c[0];const m=[];m.push(new N(e.xmax,e.ymin,n)),m.push(new N(e.xmax,(e.ymin+e.ymax)/2,n)),m.push(new N(e.xmax,e.ymax,n));const p=m.map(f=>ee(f,t,i)).filter(f=>!isNaN(f?.x)).map(f=>f.x);o.xmax=Math.max.apply(null,p)}if(x<r&&y>u){o.xmax=c[1];const m=[];m.push(new N(e.xmin,e.ymin,n)),m.push(new N(e.xmin,(e.ymin+e.ymax)/2,n)),m.push(new N(e.xmin,e.ymax,n));const p=m.map(f=>ee(f,t,i)).filter(f=>!isNaN(f?.x)).map(f=>f.x);o.xmin=Math.min.apply(null,p)}}else{const y=G(t,.001);Math.abs(o.xmin-c[0])<y&&(o.xmin=c[0]),Math.abs(o.xmax-c[1])<y&&(o.xmax=c[1])}return o}function k(e,t=!1){if(!e)return null;const i=t?20037508342787e-6:20037508342788905e-9;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*Ce[e.wkid]||null}function J(e,t=!1){if(e.isGeographic)return[-180,180];const i=k(e,t);return i!=null?[-i/2,i/2]:null}function ge(e,t,i,s){let a=(e-t)/i;return a-Math.floor(a)!=0?a=Math.floor(a):s&&(a-=1),a}function ie(e,t=!1){const i=k(e.spatialReference);if(i==null)return 0;const s=t?0:-(i/2),a=G(e.spatialReference),n=!t&&Math.abs(e.xmax-i/2)<a?i/2:e.xmax,o=!t&&Math.abs(e.xmin+i/2)<a?-i/2:e.xmin;return ge(n,s,i,!0)-ge(o,s,i,!1)}function Fe(e){const t=e.storageInfo.origin.x,i=k(e.spatialReference,!0);if(i==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=i/2,{nativePixelSize:a,storageInfo:n,extent:o}=e,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:r}=n;let u=a.x;const w=[],y=e.transform!=null&&e.transform.type==="gcs-shift",x=t+(y?0:s),m=y?i-t:s-t;for(let p=0;p<=l;p++){const f=(o.xmax-t)/u/c,M=f-Math.floor(f)==0?f:Math.ceil(f),g=m/u/c,h=g-Math.floor(g)==0?g:Math.ceil(g),d=Math.floor(x/u/c),R=Math.round(x/u)%c,b=(c-Math.round(m/u)%c)%c;w.push({resolutionX:u,blockWidth:c,datasetColumnCount:M,worldColumnCountFromOrigin:h,leftMargin:R,rightPadding:b,originColumnOffset:d}),u*=r}return{originX:t,halfWorldWidth:s,pyramidsInfo:w,hasGCSSShiftTransform:y}}function Be(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let i;return H.has(t)?i=H.get(t):(i=(e.wkid?v.coordsys(e.wkid):v.fromString(C.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),H.set(t,i)),new ve({wkid:i})}function Ye(e){const t=e.isAdaptive&&e.spacing==null;let i=e.spacing||[B,B],s=oe(e),a={cols:s.size[0]+1,rows:s.size[1]+1};const n=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let o=s.outofBoundPointCount===s.offsets.length/2||t&&n?[0,0]:fe(s.offsets,a,i,V);const l=(o[0]+o[1])/2,c=e.projectedExtent.spatialReference,r=e.srcBufferExtent.spatialReference;if(t&&(n||l>V)&&($(c,r,e.datumTransformation)&&(c.isGeographic||I(c)),i=[Y,Y],s=oe({...e,spacing:i}),a={cols:s.size[0]+1,rows:s.size[1]+1},o=fe(s.offsets,a,i,V)),s.error=o,i[0]>1&&(s.coefficients=ye(s.offsets,a,n)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(r.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:i};else{const u=I(c);if(u!=null&&!u.isEnvelope){const w=Be(c),y=ne(e.projectedExtent,w),{offsets:x}=oe({...e,srcBufferExtent:y,spacing:i}),m=ye(x,a,n);s.gcsGrid={offsets:x,coefficients:m,spacing:i}}}return s}function oe(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:s,datumTransformation:a,rasterTransform:n}=e,o=t.spatialReference,l=i.spatialReference,c=W(o,l),{xmin:r,ymin:u,xmax:w,ymax:y}=t,x=k(l),m=x!=null&&(e.hasWrapAround||n?.type==="gcs-shift"),p=e.spacing||[B,B],f=p[0]*s.x,M=p[1]*s.y,g=p[0]===1,h=Math.ceil((w-r)/f-.1/p[0])+(g?0:1),d=Math.ceil((y-u)/M-.1/p[1])+(g?0:1),R=ze({cols:h,rows:d,xmin:r,ymax:y,xres:f,yres:M,inSR:o,outSR:l,datumTransformation:a,preferPE:p[0]<=Y,usePixelCenter:g}),b=[];let E,S=0;const T=g?-1:NaN,{xmin:z,xmax:j,ymax:X,width:we,height:Me}=i,Re=G(l,q),be=x!=null&&z>0&&j>x/2;let se=!1;if(c){const _=I(o);se=_!=null&&_.poleLocation>0}for(let _=0;_<h;_++){const D=[];for(let A=0;A<d;A++){let P=R[_*d+A];if(m&&P[0]>j&&P[0]>x/2-Re?P[0]-=x:m&&_===0&&P[0]<0&&be&&!n&&(P[0]+=x),!P||isNaN(P[0])||isNaN(P[1]))b.push(T),b.push(T),D.push(null),S++;else{if(n){const ae=n.inverseTransform(new N({x:P[0],y:P[1],spatialReference:l}));P=[ae.x,ae.y]}D.push(P),_>0&&m&&E[A]&&P[0]<E[A][0]&&(P[0]+=x,se&&P[0]>j&&P[0]>x&&(P[0]-=x)),b.push((P[0]-z)/we),b.push((X-P[1])/Me)}}E=D}return{offsets:b,error:null,coefficients:null,outofBoundPointCount:S,spacing:p,size:g?[h,d]:[h-1,d-1]}}function ye(e,t,i){const{cols:s,rows:a}=t,n=new Float32Array((s-1)*(a-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),l=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let c=0;c<s-1;c++){for(let r=0;r<a-1;r++){let u=c*a*2+2*r;const w=e[u],y=e[u+1],x=e[u+2],m=e[u+3];u+=2*a;const p=e[u],f=e[u+1],M=e[u+2],g=e[u+3];let h=0,d=12*(r*(s-1)+c);for(let R=0;R<3;R++)n[d++]=o[h++]*w+o[h++]*x+o[h++]*M;h=0;for(let R=0;R<3;R++)n[d++]=o[h++]*y+o[h++]*m+o[h++]*g;h=0;for(let R=0;R<3;R++)n[d++]=l[h++]*w+l[h++]*p+l[h++]*M;h=0;for(let R=0;R<3;R++)n[d++]=l[h++]*y+l[h++]*f+l[h++]*g}if(i)for(let r=0;r<n.length;r++)isNaN(n[r])&&(n[r]=-1)}return n}function qe(e,t){const i=e.clone().normalize();return i.length===1?i[0]:he(i,t)}function Je(e){const{spatialReference:t}=e,i=Ne(t);if(!i)return e;const[s,a]=i.valid,n=a-s;let o=0;if(e.xmin<s){const l=s-e.xmin;o=Math.ceil(l/n)}else if(e.xmin>a){const l=e.xmin-a;o=-Math.ceil(l/n)}return new F({spatialReference:e.spatialReference,xmin:e.xmin+o*n,ymin:e.ymin,xmax:e.xmax+o*n,ymax:e.ymax})}function Xe(e,t,i){const{storageInfo:s,pixelSize:a}=t;let n=0,o=!1;const{pyramidResolutions:l}=s,c=s.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,s.tileInfo.dpi/96)):1,r=(e.x+e.y)/2/c;if(l!=null&&l.length){const m=l[l.length-1],p=(m.x+m.y)/2,f=(a.x+a.y)/2;if(r<=f)n=0;else if(r>=p)n=l.length,o=r/p>8;else{let g,h=f;for(let d=1;d<=l.length;d++){if(g=(l[d-1].x+l[d-1].y)/2,r<=g){r===g?n=d:i==="down"?(n=d-1,o=r/h>8):n=i==="up"||r-h>g-r||r/h>2?d:d-1;break}h=g}}const M=n===0?a:l[n-1];return o&&Math.min(M.x,M.y)*O(t.spatialReference)>19567&&(o=!1),{pyramidLevel:n,pyramidResolution:new N({x:M.x,y:M.y,spatialReference:t.spatialReference}),excessiveReading:o}}const u=Math.log(e.x/a.x)/Math.LN2,w=Math.log(e.y/a.y)/Math.LN2,y=t.storageInfo.maximumPyramidLevel||0;n=i==="down"?Math.floor(Math.min(u,w)):i==="up"?Math.ceil(Math.max(u,w)):Math.round((u+w)/2),n<0?n=0:n>y&&(o=n>y+3,n=y);const x=2**n;return{pyramidLevel:n,pyramidResolution:new N({x:x*t.nativePixelSize.x,y:x*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function de(e,t){const{pixelSize:i,extent:s}=e,a=ue(s,t,!1);return ne(qe(s,(i.x+i.y)/16),t,a)}function De(e,t,i){const s=i?.tileSize,a=i?.alignGlobalDatasetWithAGOL,{extent:n,spatialReference:o,pixelSize:l}=e,c=Q(new N({x:l.x,y:l.y,spatialReference:o}),t,n);if(c==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const r=(c.x+c.y)/2,u=O(t),w=r*u*96*39.37,y=t.isGeographic?256/s*2958287637958547e-7:256/s*591657527591555e-6;let x=e.dataType==="vector-magdir"||e.dataType==="vector-uv";const m=de(e,t),p=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(y/2/w)/Math.LN2));if(!x&&a&&(t.isGeographic||t.isWebMercator)){const S=k(t);if(x=ie(m)>0||S!=null&&m.width>S/4,!x&&S!=null){let T=-1;if(p<3)T=2**p*r*s;else if(e.storageInfo){const{maximumPyramidLevel:j=0,pyramidScalingFactor:X=2}=e.storageInfo;T=X**j*r*s}const z=Math.ceil(S/T);x=z===1||z===2&&S/2-m.xmax<T}}let f,M=w;const g=1.001,h=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(x){M=y;const S=t.isGeographic?1341104507446289e-21:.29858214164761665,T=S*(96*u*39.37),z=t.isGeographic?4326:3857;f=Q(new N({x:S,y:S,spatialReference:{wkid:z}}),o,m),f.x*=M/T,f.y*=M/T}else{f={x:l.x,y:l.y};let S=0;for(;M<y*(g/2)&&S<p;)S++,M*=h,f.x*=h,f.y*=h;Math.max(M,y)/Math.min(M,y)<=g&&(M=y)}const d=[M],R=[{x:f.x,y:f.y}],b=70.5310735,E=Math.min(b,w)/g;for(;M>=E;)M/=h,f.x/=h,f.y/=h,d.push(M),R.push({x:f.x,y:f.y});return{projectedPixelSize:c,scales:d,srcResolutions:R,isCustomTilingScheme:!x}}export{Q as C,k as D,ne as J,$ as M,_e as T,je as U,ie as V,Fe as Z,De as a,Ye as e,ee as j,Je as o,Xe as r,de as s,ue as v};
