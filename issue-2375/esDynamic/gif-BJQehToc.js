import{b2 as q}from"./main-C02UbYD7.js";var x={},D={},w={};Object.defineProperty(w,"__esModule",{value:!0}),w.loop=w.conditional=w.parse=void 0;var V=function r(a,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;if(Array.isArray(e))e.forEach(function(o){return r(a,o,n,i)});else if(typeof e=="function")e(a,n,i,r);else{var s=Object.keys(e)[0];Array.isArray(e[s])?(i[s]={},r(a,e[s],n,i[s])):i[s]=e[s](a,n,i,r)}return n};w.parse=V;var H=function(r,a){return function(e,n,i,s){a(e,n,i)&&s(e,r,n,i)}};w.conditional=H;var J=function(r,a){return function(e,n,i,s){for(var o=[],u=e.pos;a(e,n,i);){var l={};if(s(e,r,n,l),e.pos===u)break;u=e.pos,o.push(l)}return o}};w.loop=J;var f={};Object.defineProperty(f,"__esModule",{value:!0}),f.readBits=f.readArray=f.readUnsigned=f.readString=f.peekBytes=f.readBytes=f.peekByte=f.readByte=f.buildStream=void 0;var K=function(r){return{data:r,pos:0}};f.buildStream=K;var O=function(){return function(r){return r.data[r.pos++]}};f.readByte=O;var L=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(a){return a.data[a.pos+r]}};f.peekByte=L;var I=function(r){return function(a){return a.data.subarray(a.pos,a.pos+=r)}};f.readBytes=I;var N=function(r){return function(a){return a.data.subarray(a.pos,a.pos+r)}};f.peekBytes=N;var Q=function(r){return function(a){return Array.from(I(r)(a)).map(function(e){return String.fromCharCode(e)}).join("")}};f.readString=Q;var W=function(r){return function(a){var e=I(2)(a);return r?(e[1]<<8)+e[0]:(e[0]<<8)+e[1]}};f.readUnsigned=W;var X=function(r,a){return function(e,n,i){for(var s=typeof a=="function"?a(e,n,i):a,o=I(r),u=new Array(s),l=0;l<s;l++)u[l]=o(e);return u}};f.readArray=X;var Y=function(r,a,e){for(var n=0,i=0;i<e;i++)n+=r[a+i]&&Math.pow(2,e-i-1);return n},Z=function(r){return function(a){for(var e=O()(a),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(e&1<<i);return Object.keys(r).reduce(function(s,o){var u=r[o];return u.length?s[o]=Y(n,u.index,u.length):s[o]=n[u.index],s},{})}};f.readBits=Z,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=w,e=f,n={blocks:function(t){for(var d=0,c=[],g=t.data.length,h=0,y=(0,e.readByte)()(t);y!==d&&y;y=(0,e.readByte)()(t)){if(t.pos+y>=g){var m=g-t.pos;c.push((0,e.readBytes)(m)(t)),h+=m;break}c.push((0,e.readBytes)(y)(t)),h+=y}for(var B=new Uint8Array(h),b=0,v=0;v<c.length;v++)B.set(c[v],b),b+=c[v].length;return B}},i=(0,a.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(t){var d=(0,e.peekBytes)(2)(t);return d[0]===33&&d[1]===249}),s=(0,a.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,a.conditional)({lct:(0,e.readArray)(3,function(t,d,c){return Math.pow(2,c.descriptor.lct.size+1)})},function(t,d,c){return c.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},n]}]},function(t){return(0,e.peekByte)()(t)===44}),o=(0,a.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(t,d,c){return(0,e.readBytes)(c.text.blockSize)(t)}},n]},function(t){var d=(0,e.peekBytes)(2)(t);return d[0]===33&&d[1]===1}),u=(0,a.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(t,d,c){return(0,e.readString)(c.blockSize)(t)}},n]},function(t){var d=(0,e.peekBytes)(2)(t);return d[0]===33&&d[1]===255}),l=(0,a.conditional)({comment:[{codes:(0,e.readBytes)(2)},n]},function(t){var d=(0,e.peekBytes)(2)(t);return d[0]===33&&d[1]===254}),p=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,a.conditional)({gct:(0,e.readArray)(3,function(t,d){return Math.pow(2,d.lsd.gct.size+1)})},function(t,d){return d.lsd.gct.exists}),{frames:(0,a.loop)([i,u,l,s,o],function(t){var d=(0,e.peekByte)()(t);return d===33||d===44})}];r.default=p}(D);var S={};Object.defineProperty(S,"__esModule",{value:!0}),S.deinterlace=void 0;var $=function(r,a){for(var e=new Array(r.length),n=r.length/a,i=function(t,d){var c=r.slice(d*a,(d+1)*a);e.splice.apply(e,[t*a,a].concat(c))},s=[0,4,2,1],o=[8,8,4,2],u=0,l=0;l<4;l++)for(var p=s[l];p<n;p+=o[l])i(p,u),u++;return e};S.deinterlace=$;var z={};Object.defineProperty(z,"__esModule",{value:!0}),z.lzw=void 0;var ee=function(r,a,e){var n,i,s,o,u,l,p,t,d,c,g,h,y,m,B,b,v=4096,C=-1,j=e,F=new Array(e),M=new Array(v),k=new Array(v),A=new Array(v+1);for(u=(i=1<<(c=r))+1,n=i+2,p=C,s=(1<<(o=c+1))-1,t=0;t<i;t++)M[t]=0,k[t]=t;for(g=h=y=m=B=b=0,d=0;d<j;){if(m===0){if(h<o){g+=a[b]<<h,h+=8,b++;continue}if(t=g&s,g>>=o,h-=o,t>n||t==u)break;if(t==i){s=(1<<(o=c+1))-1,n=i+2,p=C;continue}if(p==C){A[m++]=k[t],p=t,y=t;continue}for(l=t,t==n&&(A[m++]=y,t=p);t>i;)A[m++]=k[t],t=M[t];y=255&k[t],A[m++]=y,n<v&&(M[n]=p,k[n]=y,!(++n&s)&&n<v&&(o++,s+=n)),p=l}m--,F[B++]=A[m],d++}for(d=B;d<j;d++)F[d]=0;return F};z.lzw=ee,Object.defineProperty(x,"__esModule",{value:!0});var T=x.decompressFrames=x.decompressFrame=G=x.parseGIF=void 0,re=oe(D),te=w,ne=f,ae=S,ie=z;function oe(r){return r&&r.__esModule?r:{default:r}}var se=function(r){var a=new Uint8Array(r);return(0,te.parse)((0,ne.buildStream)(a),re.default)},G=x.parseGIF=se,de=function(r){for(var a=r.pixels.length,e=new Uint8ClampedArray(4*a),n=0;n<a;n++){var i=4*n,s=r.pixels[n],o=r.colorTable[s]||[0,0,0];e[i]=o[0],e[i+1]=o[1],e[i+2]=o[2],e[i+3]=s!==r.transparentIndex?255:0}return e},P=function(r,a,e){if(r.image){var n=r.image,i=n.descriptor.width*n.descriptor.height,s=(0,ie.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(s=(0,ae.deinterlace)(s,n.descriptor.width));var o={pixels:s,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=a,r.gce&&(o.delay=10*(r.gce.delay||10),o.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(o.transparentIndex=r.gce.transparentColorIndex)),e&&(o.patch=de(o)),o}console.warn("gif frame does not have associated image.")};x.decompressFrame=P;var ce=function(r,a){return r.frames.filter(function(e){return e.image}).map(function(e){return P(e,r.gct,a)})};let _,U,R;function ue(r,a){return _??=document.createElement("canvas"),_.width=r,_.height=a,_.getContext("2d",{willReadFrequently:!0})}async function le(r,a){const e=G(r),n=T(e,!0),{width:i,height:s}=e.lsd,o=ue(i,s),u=[],l=[];let p=0;for(const t of n){const d=q(t.delay||100);l.push(d),p+=d;const c=fe(new ImageData(t.patch,t.dims.width,t.dims.height)),g=t.disposalType===3?o.getImageData(t.dims.left,t.dims.top,t.dims.width,t.dims.height):void 0;o.drawImage(c,t.dims.left,t.dims.top);const h=o.getImageData(0,0,i,s);u.push(h),t.disposalType===1||(t.disposalType===2?o.clearRect(t.dims.left,t.dims.top,t.dims.width,t.dims.height):t.disposalType===3&&o.putImageData(g,t.dims.left,t.dims.top))}return{frameCount:n.length,duration:p,frameDurations:l,getFrame:t=>u[t],width:i,height:s}}function fe(r){return U??=document.createElement("canvas"),R??=U.getContext("2d",{willReadFrequently:!0}),U.width=r.width,U.height=r.height,R.putImageData(r,0,0),U}T=x.decompressFrames=ce;const pe=[71,73,70];function E(r){const a=new Uint8Array(r);return!pe.some((e,n)=>e!==a[n])}function ge(r){if(!E(r))return!1;const a=new DataView(r),e=a.getUint8(10);let n=13+(128&e?3*2**(1+(7&e)):0),i=0,s=!1;for(;!s;){switch(a.getUint8(n++)){case 33:if(!o())return!1;break;case 44:u();break;case 59:s=!0;break;default:return!1}if(i>1)return!0}function o(){switch(a.getUint8(n++)){case 249:l();break;case 1:p();break;case 254:t();break;case 255:d();break;default:return!1}return!0}function u(){i++,n+=8;const g=a.getUint8(n++);n+=128&g?3*2**(1+(7&g)):0,n++,c()}function l(){n++,n+=4,c()}function p(){i++,n++,n+=12,c()}function t(){c()}function d(){n++,n+=8,n+=3,c()}function c(){let g;for(;g=a.getUint8(n++);)n+=g}return!1}export{ge as isAnimatedGIF,E as isGIF,le as parseGif};
