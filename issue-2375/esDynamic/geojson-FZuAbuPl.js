import{t as E}from"./date-CID61X27.js";import{s as P,aq as x,d2 as G,d3 as C,d4 as D,d5 as J}from"./main-C02UbYD7.js";const R={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function m(e){return R[e]}function*M(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const n of e.features)n&&(yield n)}}function*$(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const n of e.coordinates)yield*n;break;case"MultiPolygon":for(const n of e.coordinates)for(const o of n)yield*o}}function*v(e,n={}){const{geometryType:o,objectIdField:t}=n;for(const r of e){const{geometry:s,properties:d,id:i}=r;if(s&&m(s.type)!==o)continue;const l=d||{};let c;t&&(c=l[t],i==null||c||(l[t]=c=i)),yield new D(s?H(new J,s,n):null,l,null,c??void 0)}}function A(e){for(const n of e)if(n.length>2)return!0;return!1}function Z(e){return!T(e)}function q(e){return T(e)}function T(e){let n=0;for(let o=0;o<e.length;o++){const t=e[o],r=e[(o+1)%e.length];n+=t[0]*r[1]-r[0]*t[1]}return n<=0}function L(e){const n=e[0],o=e[e.length-1];return n[0]===o[0]&&n[1]===o[1]&&n[2]===o[2]||e.push(n),e}function H(e,n,o){switch(n.type){case"LineString":return z(e,n,o);case"MultiLineString":return B(e,n,o);case"MultiPoint":return K(e,n,o);case"MultiPolygon":return Q(e,n,o);case"Point":return U(e,n,o);case"Polygon":return V(e,n,o)}}function z(e,n,o){return g(e,n.coordinates,o),e}function B(e,n,o){for(const t of n.coordinates)g(e,t,o);return e}function K(e,n,o){return g(e,n.coordinates,o),e}function Q(e,n,o){for(const t of n.coordinates){I(e,t[0],o);for(let r=1;r<t.length;r++)N(e,t[r],o)}return e}function U(e,n,o){return b(e,n.coordinates,o),e}function V(e,n,o){const t=n.coordinates;I(e,t[0],o);for(let r=1;r<t.length;r++)N(e,t[r],o);return e}function I(e,n,o){const t=L(n);Z(t)?O(e,t,o):g(e,t,o)}function N(e,n,o){const t=L(n);q(t)?O(e,t,o):g(e,t,o)}function g(e,n,o){for(const t of n)b(e,t,o);e.lengths.push(n.length)}function O(e,n,o){for(let t=n.length-1;t>=0;t--)b(e,n[t],o);e.lengths.push(n.length)}function b(e,n,o){const[t,r,s]=n;e.coords.push(t,r),o.hasZ&&e.coords.push(s||0)}function W(e){switch(typeof e){case"string":return E(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function _(e,n=4326){if(!e)throw new P("geojson-layer:empty","GeoJSON data is empty");if(e.type!=="Feature"&&e.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:o}=e;if(!o)return;const t=typeof o=="string"?o:o.type==="name"?o.properties.name:o.type==="EPSG"?o.properties.code:null,r=x({wkid:n})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${n})$`,"i");if(!t||!r.test(t))throw new P("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:o})}function X(e,n={}){const o=[],t=new Set,r=new Set;let s,d=!1,i=null,l=!1,{geometryType:c=null}=n,S=!1;for(const p of M(e)){const{geometry:h,properties:u,id:a}=p;if((!h||(c||(c=m(h.type)),m(h.type)===c))&&(d||(d=A($(h))),l||(l=a!=null,l&&(s=typeof a,u&&(i=Object.keys(u).filter(y=>u[y]===a)))),u&&i&&l&&a!=null&&(i.length>1?i=i.filter(y=>u[y]===a):i.length===1&&(i=u[i[0]]===a?i:[])),!S&&u)){let y=!0;for(const f in u){if(t.has(f))continue;const F=u[f];if(F==null){y=!1,r.add(f);continue}const j=W(F);if(j==="unknown"){r.add(f);continue}r.delete(f),t.add(f);const k=G(f);k&&o.push({name:k,alias:f,type:j})}S=y}}const w=G(i?.length===1&&i[0]||null)??void 0;if(w){for(const p of o)if(p.name===w&&C(p)){p.type="esriFieldTypeOID";break}}return{fields:o,geometryType:c,hasZ:d,objectIdFieldName:w,objectIdFieldType:s,unknownFields:Array.from(r)}}function Y(e,n){return Array.from(v(M(e),n))}export{_ as E,X as I,Y as N,m as u};
