{"version":3,"file":"OverlayContainer-DTz9rl8F.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{identity as t,multiply as e,translate as r,scale as s,rotate as o}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as i}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as a}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as l}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as c}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as p}from\"../../viewpointUtils.js\";import{brushes as m}from\"../brushes.js\";import{WGLDrawPhase as d}from\"./enums.js\";import h from\"./WGLContainer.js\";class f extends h{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=i()}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:\"overlay\",brushes:[m.overlay],target:()=>this.children,drawPhase:d.MAP});return[...super.prepareRenderPasses(t),e]}_updateMatrices(i){const{state:c}=i,{id:p,size:m,pixelRatio:d,resolution:h,rotation:f,viewpoint:u,displayMat3:M}=c;if(this._viewStateId===p)return;const v=Math.PI/180*f,g=d*m[0],_=d*m[1];this._localOrigin=u.targetGeometry.clone();const{x:y,y:b}=this._localOrigin,x=l(y,c.spatialReference);this._localOrigin.x=x,this._localOrigin.y=b;const j=h*g,w=h*_,R=t(this._dvsMat3);e(R,R,M),r(R,R,a(g/2,_/2)),s(R,R,n(g/j,-_/w,1)),o(R,R,-v),this._viewStateId=p}_updateOverlays(t,e){const{state:r}=t,{rotation:s,spatialReference:o,worldScreenWidth:i,size:a,viewpoint:n}=r,l=this._localOrigin;let m,d=0;const h=c(o);if(h&&o.isWrappable){const t=a[0],e=a[1],l=180/Math.PI*s,c=Math.abs(Math.cos(l)),f=Math.abs(Math.sin(l)),u=Math.round(t*c+e*f),[M,v]=h.valid,g=p(o),{x:_,y}=n.targetGeometry,b=[_,y],x=[0,0];r.toScreen(x,b);const j=[0,0];let w;w=u>i?.5*i:.5*u;const R=Math.floor((_+.5*g)/g),O=M+R*g,P=v+R*g,I=[x[0]+w,0];r.toMap(j,I),j[0]>P&&(d=g),I[0]=x[0]-w,r.toMap(j,I),j[0]<O&&(d=-g),m={worldWidth:g,xBounds:[M,v]}}for(const c of e)c.updateDrawCoords(l,d,o,m)}}export{f as default};\n"],"names":["f","h","i","t","e","m","d","c","p","M","v","g","_","y","b","x","l","j","w","R","r","a","s","n","o","u","O","P","I"],"mappings":"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","x_google_ignoreList":[0]}