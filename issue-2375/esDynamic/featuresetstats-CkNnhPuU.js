import{m}from"./TimeOnly-CAgpzQQx.js";import{a as h,B as f,U as d,G as w,Q as l,b as S,r as p,$ as u,P as c,A as v}from"./arcadeUtils-Cqggt430.js";import{O as g,r as T}from"./WhereClause-CoIZdsJ6.js";async function o(n,t,e,i){if(e.length===1){if(d(e[0]))return u(n,e[0],c(e[1],-1));if(l(e[0]))return u(n,e[0].toArray(),c(e[1],-1))}else if(e.length===2){if(d(e[0]))return u(n,e[0],c(e[1],-1));if(l(e[0]))return u(n,e[0].toArray(),c(e[1],-1));if(f(e[0])){const r=await e[0].load(),a=await A(g.create(e[1],r.getFieldsIndex(),r.dateFieldsTimeZoneDefaultUTC),i,t);return y(t,await e[0].calculateStatistic(n,a,c(e[2],1e3),t.abortSignal))}}else if(e.length===3&&f(e[0])){const r=await e[0].load(),a=await A(g.create(e[1],r.getFieldsIndex(),r.dateFieldsTimeZoneDefaultUTC),i,t);return y(t,await e[0].calculateStatistic(n,a,c(e[2],1e3),t.abortSignal))}return u(n,e,-1)}function y(n,t){return t instanceof T?m.fromReaderAsTimeStampOffset(t.toStorageFormat()):t instanceof Date?m.dateJSAndZoneToArcadeDate(t,v(n)):t}async function A(n,t,e){const i=n.getVariables();if(i.length>0){const r=[];for(let s=0;s<i.length;s++){const F={name:i[s]};r.push(await t.evaluateIdentifier(e,F))}const a={};for(let s=0;s<i.length;s++)a[i[s]]=r[s];return n.parameters=a,n}return n}function b(n){n.mode==="async"&&(n.functions.stdev=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("stdev",t,a,n))},n.functions.variance=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("variance",t,a,n))},n.functions.average=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("mean",t,a,n))},n.functions.mean=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("mean",t,a,n))},n.functions.sum=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("sum",t,a,n))},n.functions.min=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("min",t,a,n))},n.functions.max=function(t,e){return n.standardFunctionAsync(t,e,(i,r,a)=>o("max",t,a,n))},n.functions.count=function(t,e){return n.standardFunctionAsync(t,e,async(i,r,a)=>{if(h(a,1,1,t,e),f(a[0]))return a[0].count(i.abortSignal);if(d(a[0])||w(a[0]))return a[0].length;if(l(a[0]))return a[0].length();throw new S(t,p.InvalidParameter,e)})})}export{b as registerFunctions};
