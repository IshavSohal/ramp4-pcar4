import{C as ce,Y as ue,M as fe,L as we,f as pe,a as H,z as I,b as l,r as s,p as de,e as Z,o as he,s as Y,c as y,x as O,O as p,R as b,J as k,_ as v,d as ge,u as me,G as h,N as C,U as E,Q as B,H as R,B as ye,E as A,g as d,h as J,m as M,i as ve,j as D,k as be,Z as Se,D as Q,l as xe,n as G,q as X,t as Ie}from"./arcadeUtils-Cqggt430.js";import{registerFunctions as Ce}from"./geomasync-DDScb48D.js";import{bv as $,eB as ee}from"./main-C02UbYD7.js";const j=100;async function U(t,e){const r=[];for(let a=0;a<e.arguments.length;a++)r.push(await c(t,e.arguments[a]));return r}async function x(t,e,r){return e.preparsed===!0?r(t,null,e.arguments):r(t,e,await U(t,e))}class Fe extends xe{constructor(e,r){super(),this.definition=null,this.context=null,this.definition=e,this.context=r}createFunction(e){return(...r)=>{const a={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(a.depthCounter.depth>64)throw new l(e,s.MaximumCallDepth,null);return z(this.definition,a,r,null)}}call(e,r){return L(e,r,(a,o,n)=>{const i={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(i.depthCounter.depth>64)throw new l(e,s.MaximumCallDepth,r);return z(this.definition,i,n,r)})}marshalledCall(e,r,a,o){return o(e,r,async(n,i,u)=>{const f={spatialReference:e.spatialReference,globalScope:a.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return u=u.map(w=>!v(w)||w instanceof G?w:X(w,e,o)),X(await z(this.definition,f,u,r),a,o)})}}class F extends Ie{constructor(e){super(e)}async global(e){const r=this.executingContext.globalScope[e.toLowerCase()];if(r.valueset||(r.value=await c(this.executingContext,r.node),r.valueset=!0),v(r.value)&&!(r.value instanceof G)){const a=new G;a.fn=r.value,a.parameterEvaluator=L,a.context=this.executingContext,r.value=a}return r.value}setGlobal(e,r){if(v(r))throw new l(null,s.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:r,valueset:!0,node:null}}hasGlobal(e){return this.executingContext.exports[e]===void 0&&(e=e.toLowerCase()),this.executingContext.exports[e]!==void 0}async loadModule(e){let r=e.spatialReference;r==null&&(r=new $({wkid:102100})),this.moduleScope=ie({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:r,services:e.services,libraryResolver:new Y(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??le,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await c(this.executingContext,this.source.syntax)}}async function L(t,e,r){return e.preparsed===!0?r(t,null,e.arguments):r(t,e,await U(t,e))}async function c(t,e,r){if(e.breakpoint&&r!==!0)return await e.breakpoint(),c(t,e,!0);try{switch(e?.type){case"VariableDeclarator":return await Te(t,e);case"ImportDeclaration":return await Ue(t,e);case"ExportNamedDeclaration":return await qe(t,e);case"VariableDeclaration":return await ae(t,e,0);case"BlockStatement":case"Program":return await Ze(t,e);case"FunctionDeclaration":return await Ge(t,e);case"ReturnStatement":return await De(t,e);case"IfStatement":return await Ke(t,e);case"ExpressionStatement":return await Pe(t,e);case"UpdateExpression":return await Be(t,e);case"AssignmentExpression":return await je(t,e);case"ForStatement":return await Ne(t,e);case"WhileStatement":return await Me(t,e);case"ForInStatement":return await Ee(t,e);case"BreakStatement":return b;case"EmptyStatement":return p;case"ContinueStatement":return k;case"TemplateElement":return await Je(t,e);case"TemplateLiteral":return await Xe(t,e);case"Identifier":return await W(t,e);case"MemberExpression":return await _e(t,e);case"Literal":return e.value;case"CallExpression":return await Ye(t,e);case"UnaryExpression":return await Ve(t,e);case"BinaryExpression":return await ze(t,e);case"LogicalExpression":return await He(t,e);case"ArrayExpression":return await We(t,e);case"ObjectExpression":return await Re(t,e);case"Property":return await Ae(t,e);default:throw new l(t,s.Unrecognized,e)}}catch(a){throw me(t,e,a)}}async function Re(t,e){const r=[];for(let i=0;i<e.properties.length;i++)r[i]=await c(t,e.properties[i]);const a={},o=new Map;for(let i=0;i<r.length;i++){const u=r[i];if(v(u.value))throw new l(t,s.NoFunctionInDictionary,e);if(h(u.key)===!1)throw new l(t,s.KeyMustBeString,e);let f=u.key.toString();const w=f.toLowerCase();o.has(w)?f=o.get(w):o.set(w,f),u.value===p?a[f]=null:a[f]=u.value}const n=new C(a);return n.immutable=!1,n}async function Ae(t,e){const r=await c(t,e.value);return e.key.type==="Identifier"?{key:e.key.name,value:r}:{key:await c(t,e.key),value:r}}async function Me(t,e){const r={testResult:!0,lastAction:p};if(r.testResult=await c(t,e.test),r.testResult===!1)return p;if(r.testResult!==!0)throw new l(t,s.BooleanConditionRequired,e);for(;r.testResult===!0&&(r.lastAction=await c(t,e.body),r.lastAction!==b)&&!(r.lastAction instanceof y);)if(r.testResult=await c(t,e.test),r.testResult!==!0&&r.testResult!==!1)throw new l(t,s.BooleanConditionRequired,e);return r.lastAction instanceof y?r.lastAction:p}async function te(t,e,r){const a=await c(t,e.body);return r.lastAction=a,r.lastAction===b||r.lastAction instanceof y?(r.testResult=!1,r):(e.update!==null&&await c(t,e.update),r)}async function Le(t,e,r){if(e.test!==null){const a=await c(t,e.test);if(t.abortSignal?.aborted===!0)throw new l(t,s.Cancelled,e);if(r.testResult=a,r.testResult===!1)return r;if(r.testResult!==!0)throw new l(t,s.BooleanConditionRequired,e);return te(t,e,r)}return te(t,e,r)}function P(t,e,r,a,o,n){try{Le(t,e,r).then(()=>{try{r.testResult===!0?++n>j?(n=0,setTimeout(()=>{P(t,e,r,a,o,n)},0)):P(t,e,r,a,o,n):r.lastAction instanceof y?a(r.lastAction):a(p)}catch(i){o(i)}},i=>{o(i)})}catch(i){o(i)}}function Ne(t,e){try{return e.init!==null?c(t,e.init).then(()=>new Promise((r,a)=>{P(t,e,{testResult:!0,lastAction:p},o=>{r(o)},o=>{a(o)},0)})):new Promise((r,a)=>{P(t,e,{testResult:!0,lastAction:p},o=>{r(o)},o=>{a(o)},0)})}catch(r){return Promise.reject(r)}}function q(t,e,r,a,o,n,i,u,f,w){try{if(a<=n)return void u(p);o.value=i==="k"?r[n]:n,c(t,e.body).then(m=>{try{m instanceof y?u(m):m===b?u(p):++w>j?(w=0,setTimeout(()=>{q(t,e,r,a,o,n+1,i,u,f,w)},0)):q(t,e,r,a,o,n+1,i,u,f,w)}catch(K){f(K)}},m=>{f(m)})}catch(m){f(m)}}function T(t,e,r,a,o,n,i,u,f){try{if(r.length()<=o)return void i(p);a.value=n==="k"?r.get(o):o,c(t,e.body).then(w=>{w instanceof y?i(w):w===b?i(p):++f>j?(f=0,setTimeout(()=>{T(t,e,r,a,o+1,n,i,u,f)},0)):T(t,e,r,a,o+1,n,i,u,f)},w=>{u(w)})}catch(w){u(w)}}function _(t,e,r,a,o,n){try{if(n===void 0&&(n="i"),r.length===0)return void a.resolve(p);q(t,e,r,r.length,o,0,n,i=>{a.resolve(i)},i=>{a.reject(i)},0)}catch(i){a.reject(i)}}function Oe(t,e,r,a,o,n){try{if(n===void 0&&(n="i"),r.length===0)return void a.resolve(p);T(t,e,r,o,0,n,i=>{a.resolve(i)},i=>{a.reject(i)},0)}catch(i){a.reject(i)}}function ke(t,e,r,a,o){try{_(t,e,r.keys(),a,o,"k")}catch(n){a.reject(n)}}function V(t,e,r,a,o,n,i,u){try{t.next().then(f=>{try{if(f===null)n(p);else{const w=Q.createFromGraphicLikeObject(f.geometry,f.attributes,a,e.timeZone);w._underlyingGraphic=f,o.value=w,c(e,r.body).then(m=>{try{m===b?n(p):m instanceof y?n(m):++u>j?(u=0,setTimeout(()=>{V(t,e,r,a,o,n,i,u)},0)):V(t,e,r,a,o,n,i,u)}catch(K){i(K)}},m=>{i(m)})}}catch(w){i(w)}},f=>{i(f)})}catch(f){i(f)}}async function Ee(t,e){return new Promise((r,a)=>{c(t,e.right).then(o=>{try{let n=null;n=e.left.type==="VariableDeclaration"?c(t,e.left):Promise.resolve(),n.then(()=>{try{let i="";if(e.left.type==="VariableDeclaration"){const f=e.left.declarations[0].id;f.type==="Identifier"&&(i=f.name)}else e.left.type==="Identifier"&&(i=e.left.name);if(!i)throw new l(t,s.InvalidIdentifier,e);i=i.toLowerCase();let u=null;if(t.localScope!=null&&t.localScope[i]!==void 0&&(u=t.localScope[i]),u===null&&t.globalScope[i]!==void 0&&(u=t.globalScope[i]),u===null)return void a(new l(t,s.InvalidIdentifier,e));E(o)||h(o)?_(t,e,o,{reject:a,resolve:r},u):B(o)?Oe(t,e,o,{reject:a,resolve:r},u):o instanceof C||R(o)?ke(t,e,o,{reject:a,resolve:r},u):ye(o)?V(o.iterator(t.abortSignal),t,e,o,u,f=>{r(f)},f=>{a(f)},0):_(t,e,[],{reject:a,resolve:r},u)}catch(i){a(i)}},a)}catch(n){a(n)}},a)})}async function Be(t,e){const r=e.argument;if(r.type==="MemberExpression"){const n={t:null},i=await c(t,r.object);let u=null;n.t=i,r.computed===!0?u=await c(t,r.property):r.property.type==="Identifier"&&(u=r.property.name);const f=n.t;let w;if(E(f)){if(!A(u))throw new l(t,s.ArrayAccessorMustBeNumber,e);if(u<0&&(u=f.length+u),u<0||u>=f.length)throw new l(t,s.OutOfBounds,e);w=d(f[u]),f[u]=e.operator==="++"?w+1:w-1}else if(f instanceof C){if(h(u)===!1)throw new l(t,s.KeyAccessorMustBeString,e);if(f.hasField(u)!==!0)throw new l(t,s.FieldNotFound,e,{key:u});w=d(f.field(u)),f.setField(u,e.operator==="++"?w+1:w-1)}else if(f instanceof F){if(h(u)===!1)throw new l(t,s.ModuleAccessorMustBeString,e);if(f.hasGlobal(u)!==!0)throw new l(t,s.ModuleExportNotFound,e);w=d(await f.global(u)),f.setGlobal(u,e.operator==="++"?w+1:w-1)}else{if(!R(f))throw B(f)?new l(t,s.Immutable,e):new l(t,s.InvalidParameter,e);if(h(u)===!1)throw new l(t,s.KeyAccessorMustBeString,e);if(f.hasField(u)!==!0)throw new l(t,s.FieldNotFound,e,{key:u});w=d(f.field(u)),f.setField(u,e.operator==="++"?w+1:w-1)}return e.prefix===!1?w:e.operator==="++"?w+1:w-1}const a=e.argument.type==="Identifier"?e.argument.name.toLowerCase():"";if(!a)throw new l(t,s.InvalidIdentifier,e);let o;if(t.localScope!=null&&t.localScope[a]!==void 0)return o=d(t.localScope[a].value),t.localScope[a]={value:e.operator==="++"?o+1:o-1,valueset:!0,node:e},e.prefix===!1?o:e.operator==="++"?o+1:o-1;if(t.globalScope[a]!==void 0)return o=d(t.globalScope[a].value),t.globalScope[a]={value:e.operator==="++"?o+1:o-1,valueset:!0,node:e},e.prefix===!1?o:e.operator==="++"?o+1:o-1;throw new l(t,s.InvalidIdentifier,e)}function S(t,e,r,a,o){switch(e){case"=":return t===p?null:t;case"/=":return d(r)/d(t);case"*=":return d(r)*d(t);case"-=":return d(r)-d(t);case"+=":return h(r)||h(t)?M(r)+M(t):d(r)+d(t);case"%=":return d(r)%d(t);default:throw new l(o,s.UnsupportedOperator,a)}}async function je(t,e){const r=e.left;if(r.type==="MemberExpression"){const o=await c(t,r.object);let n=null;if(r.computed===!0)n=await c(t,r.property);else{if(r.property.type!=="Identifier")throw new l(t,s.InvalidIdentifier,e);n=r.property.name}const i=await c(t,e.right);if(E(o)){if(!A(n))throw new l(t,s.ArrayAccessorMustBeNumber,e);if(n<0&&(n=o.length+n),n<0||n>o.length)throw new l(t,s.OutOfBounds,e);if(n===o.length){if(e.operator!=="=")throw new l(t,s.OutOfBounds,e);o[n]=S(i,e.operator,o[n],e,t)}else o[n]=S(i,e.operator,o[n],e,t)}else if(o instanceof C){if(h(n)===!1)throw new l(t,s.KeyAccessorMustBeString,e);if(o.hasField(n)===!0)o.setField(n,S(i,e.operator,o.field(n),e,t));else{if(e.operator!=="=")throw new l(t,s.FieldNotFound,e,{key:n});o.setField(n,S(i,e.operator,null,e,t))}}else if(o instanceof F){if(h(n)===!1)throw new l(t,s.KeyAccessorMustBeString,e);if(o.hasGlobal(n)!==!0)throw new l(t,s.ModuleExportNotFound,e);o.setGlobal(n,S(i,e.operator,await o.global(n),e,t))}else{if(!R(o))throw B(o)?new l(t,s.Immutable,e):new l(t,s.InvalidParameter,e);if(h(n)===!1)throw new l(t,s.KeyAccessorMustBeString,e);if(o.hasField(n)===!0)o.setField(n,S(i,e.operator,o.field(n),e,t));else{if(e.operator!=="=")throw new l(t,s.FieldNotFound,e,{key:n});o.setField(n,S(i,e.operator,null,e,t))}}return p}const a=r.name.toLowerCase();if(t.localScope!=null&&t.localScope[a]!==void 0){const o=await c(t,e.right);return t.localScope[a]={value:S(o,e.operator,t.localScope[a].value,e,t),valueset:!0,node:e.right},p}if(t.globalScope[a]!==void 0){const o=await c(t,e.right);return t.globalScope[a]={value:S(o,e.operator,t.globalScope[a].value,e,t),valueset:!0,node:e.right},p}throw new l(t,s.InvalidIdentifier,e)}async function Pe(t,e){if(e.expression.type==="AssignmentExpression")return c(t,e.expression);if(e.expression.type==="CallExpression"){const a=await c(t,e.expression);return a===p?p:new O(a)}const r=await c(t,e.expression);return r===p?p:new O(r)}async function Ke(t,e){const r=await c(t,e.test);if(r===!0)return c(t,e.consequent);if(r===!1)return e.alternate!==null?c(t,e.alternate):p;throw new l(t,s.BooleanConditionRequired,e)}async function Ze(t,e){return re(t,e,0)}async function re(t,e,r){if(r>=e.body.length)return p;const a=await c(t,e.body[r]);return a instanceof y||a===b||a===k||r===e.body.length-1?a:re(t,e,r+1)}async function De(t,e){if(e.argument===null)return new y(p);const r=await c(t,e.argument);return new y(r)}async function Ge(t,e){const r=e.id.name.toLowerCase();return t.globalScope[r]={valueset:!0,node:null,value:new Fe(e,t)},p}async function Ue(t,e){const r=e.specifiers[0].local.name.toLowerCase(),a=t.libraryResolver.loadLibrary(r);let o=null;return t.libraryResolver._moduleSingletons?.has(a.uri)?o=t.libraryResolver._moduleSingletons.get(a.uri):(o=new F(a),await o.loadModule(t),t.libraryResolver._moduleSingletons?.set(a.uri,o)),t.globalScope[r]={value:o,valueset:!0,node:e},p}async function qe(t,e){if(await c(t,e.declaration),e.declaration.type==="FunctionDeclaration")t.exports[e.declaration.id.name.toLowerCase()]="function";else if(e.declaration.type==="VariableDeclaration")for(const r of e.declaration.declarations)t.exports[r.id.name.toLowerCase()]="variable";return p}async function ae(t,e,r){return r>=e.declarations.length?p:(await c(t,e.declarations[r]),r===e.declarations.length-1||await ae(t,e,r+1),p)}async function Te(t,e){let r=null;if(r=e.init===null?null:await c(t,e.init),t.localScope!==null){if(r===p&&(r=null),e.id.type!=="Identifier")throw new l(t,s.InvalidIdentifier,e);const o=e.id.name.toLowerCase();return t.localScope!=null&&(t.localScope[o]={value:r,valueset:!0,node:e.init}),p}if(e.id.type!=="Identifier")throw new l(t,s.InvalidIdentifier,e);const a=e.id.name.toLowerCase();return r===p&&(r=null),t.globalScope[a]={value:r,valueset:!0,node:e.init},p}async function _e(t,e){const r=await c(t,e.object);if(r===null)throw new l(t,s.MemberOfNull,e);if(e.computed===!1){if(e.property.type==="Identifier"){if(r instanceof C||R(r))return r.field(e.property.name);if(r instanceof ee)return J(r,e.property.name,t,e);if(r instanceof F){if(!r.hasGlobal(e.property.name))throw new l(t,s.InvalidIdentifier,e);return r.global(e.property.name)}throw new l(t,s.InvalidMemberAccessKey,e)}throw new l(t,s.InvalidMemberAccessKey,e)}let a=await c(t,e.property);if(r instanceof C||R(r)){if(h(a))return r.field(a);throw new l(t,s.InvalidMemberAccessKey,e)}if(r instanceof F){if(h(a))return r.global(a);throw new l(t,s.InvalidMemberAccessKey,e)}if(r instanceof ee){if(h(a))return J(r,a,t,e);throw new l(t,s.InvalidMemberAccessKey,e)}if(E(r)){if(A(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=r.length+a),a>=r.length||a<0)throw new l(t,s.OutOfBounds,e);return r[a]}throw new l(t,s.InvalidMemberAccessKey,e)}if(B(r)){if(A(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=r.length()+a),a>=r.length()||a<0)throw new l(t,s.OutOfBounds,e);return r.get(a)}throw new l(t,s.InvalidMemberAccessKey,e)}if(h(r)){if(A(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=r.length+a),a>=r.length||a<0)throw new l(t,s.OutOfBounds,e);return r[a]}throw new l(t,s.InvalidMemberAccessKey,e)}throw new l(t,s.InvalidMemberAccessKey,e)}async function Ve(t,e){const r=await c(t,e.argument);if(I(r)){if(e.operator==="!")return!r;if(e.operator==="-")return-1*d(r);if(e.operator==="+")return 1*d(r);if(e.operator==="~")return~d(r);throw new l(t,s.UnsupportedUnaryOperator,e)}if(e.operator==="-")return-1*d(r);if(e.operator==="+")return 1*d(r);if(e.operator==="~")return~d(r);throw new l(t,s.UnsupportedUnaryOperator,e)}async function We(t,e){const r=[];for(let a=0;a<e.elements.length;a++)r.push(await c(t,e.elements[a]));for(let a=0;a<r.length;a++){if(v(r[a]))throw new l(t,s.NoFunctionInArray,e);r[a]===p&&(r[a]=null)}return r}async function ze(t,e){const r=[];r[0]=await c(t,e.left),r[1]=await c(t,e.right);const a=r[0],o=r[1];switch(e.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return be(d(a),d(o),e.operator);case"==":return D(a,o);case"!=":return!D(a,o);case"<":case">":case"<=":case">=":return ve(a,o,e.operator);case"+":return h(a)||h(o)?M(a)+M(o):d(a)+d(o);case"-":return d(a)-d(o);case"*":return d(a)*d(o);case"/":return d(a)/d(o);case"%":return d(a)%d(o);default:throw new l(t,s.UnsupportedOperator,e)}}async function He(t,e){const r=await c(t,e.left);let a=null;if(!I(r))throw new l(t,s.LogicalExpressionOnlyBoolean,e);switch(e.operator){case"||":if(r===!0)return r;if(a=await c(t,e.right),I(a))return a;throw new l(t,s.LogicExpressionOrAnd,e);case"&&":if(r===!1)return r;if(a=await c(t,e.right),I(a))return a;throw new l(t,s.LogicExpressionOrAnd,e);default:throw new l(t,s.LogicExpressionOrAnd,e)}}async function W(t,e){const r=e.name.toLowerCase();if(t.localScope!=null&&t.localScope[r]!==void 0){const a=t.localScope[r];if(a.valueset===!0)return a.value;if(a.d!==null)return a.d;a.d=c(t,a.node);const o=await a.d;return a.value=o,a.valueset=!0,o}if(t.globalScope[r]!==void 0){const a=t.globalScope[r];if(a.valueset===!0)return a.value;if(a.d!==null)return a.d;a.d=c(t,a.node);const o=await a.d;return a.value=o,a.valueset=!0,o}throw new l(t,s.InvalidIdentifier,e)}async function Ye(t,e){if(e.callee.type==="MemberExpression"){const r=await c(t,e.callee.object);if(!(r instanceof F))throw new l(t,s.FunctionNotFound,e);const a=e.callee.computed===!1?e.callee.property.name:await c(t,e.callee.property);if(!r.hasGlobal(a))throw new l(t,s.FunctionNotFound,e);const o=await r.global(a);if(!v(o))throw new l(t,s.CallNonFunction,e);return o.call(t,e)}if(e.callee.type!=="Identifier")throw new l(t,s.FunctionNotFound,e);if(t.localScope!=null&&t.localScope[e.callee.name.toLowerCase()]!==void 0){const r=t.localScope[e.callee.name.toLowerCase()];if(v(r.value))return r.value.call(t,e);throw new l(t,s.CallNonFunction,e)}if(t.globalScope[e.callee.name.toLowerCase()]!==void 0){const r=t.globalScope[e.callee.name.toLowerCase()];if(v(r.value))return r.value.call(t,e);throw new l(t,s.CallNonFunction,e)}throw new l(t,s.FunctionNotFound,e)}async function Je(t,e){return e.value?e.value.cooked:""}function Qe(t,e,r){if(v(t))throw new l(e,s.NoFunctionInTemplateLiteral,r);return t}async function Xe(t,e){const r=[];for(let n=0;n<e.expressions.length;n++){const i=await c(t,e.expressions[n]);r[n]=M(i)}let a="",o=0;for(const n of e.quasis)a+=n.value?n.value.cooked:"",n.tail===!1&&(a+=r[o]?Qe(r[o],t,e):"",o++);return a}const g={};async function oe(t,e,r,a){const o=await c(t,e.arguments[r]);if(D(o,a))return c(t,e.arguments[r+1]);const n=e.arguments.length-r;return n===1?c(t,e.arguments[r]):n===2?null:n===3?c(t,e.arguments[r+2]):oe(t,e,r+2,a)}async function ne(t,e,r,a){if(a===!0)return c(t,e.arguments[r+1]);if(e.arguments.length-r===3)return c(t,e.arguments[r+2]);const o=await c(t,e.arguments[r+2]);if(I(o)===!1)throw new l(t,s.ModuleExportNotFound,e.arguments[r+2]);return ne(t,e,r+2,o)}async function z(t,e,r,a){const o=t.body;if(r.length!==t.params.length)throw new l(e,s.WrongNumberOfParameters,null);for(let i=0;i<r.length;i++){const u=t.params[i];u.type==="Identifier"&&e.localScope!=null&&(e.localScope[u.name.toLowerCase()]={d:null,value:r[i],valueset:!0,node:null})}const n=await c(e,o);if(n instanceof y)return n.value;if(n===b)throw new l(e,s.UnexpectedToken,a);if(n===k)throw new l(e,s.UnexpectedToken,a);return n instanceof O?n.value:n}ce(g,x),ue(g,x),fe(g,x),we(g,x),pe(g,x),Ce({functions:g,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:x,standardFunctionAsync:L}),g.iif=async function(t,e){H(e.arguments===null?[]:e.arguments,3,3,t,e);const r=await c(t,e.arguments[0]);if(I(r)===!1)throw new l(t,s.BooleanConditionRequired,e);return c(t,r?e.arguments[1]:e.arguments[2])},g.defaultvalue=async function(t,e){H(e.arguments===null?[]:e.arguments,2,3,t,e);const r=await c(t,e.arguments[0]);if(e.arguments.length===3){const a=await c(t,e.arguments[1]),o=de(r,a);return o!=null&&o!==""?o:c(t,e.arguments[2])}return r==null||r===""?c(t,e.arguments[1]):r},g.decode=async function(t,e){if(e.arguments.length<2)throw new l(t,s.WrongNumberOfParameters,e);if(e.arguments.length===2)return c(t,e.arguments[1]);if((e.arguments.length-1)%2==0)throw new l(t,s.WrongNumberOfParameters,e);return oe(t,e,1,await c(t,e.arguments[0]))},g.when=async function(t,e){if(e.arguments.length<3)throw new l(t,s.WrongNumberOfParameters,e);if(e.arguments.length%2==0)throw new l(t,s.WrongNumberOfParameters,e);const r=await c(t,e.arguments[0]);if(I(r)===!1)throw new l(t,s.BooleanConditionRequired,e.arguments[0]);return ne(t,e,0,r)};const $e={fixSpatialReference:Se,parseArguments:U,standardFunction:x,standardFunctionAsync:L,evaluateIdentifier:W};for(const t in g)g[t]={value:new Z(g[t]),valueset:!0,node:null};const N=function(){};function ie(t,e,r){const a=new N;t==null&&(t={}),e==null&&(e={});const o=new C({newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});o.immutable=!1,a.textformatting={value:o,valueset:!0,node:null};for(const n in e)a[n]={value:new Z(e[n]),native:!0,valueset:!0,node:null};for(const n in t)t[n]&&t[n].declaredClass==="esri.Graphic"?a[n]={value:Q.createFromGraphic(t[n],r),valueset:!0,node:null}:a[n]={value:t[n],valueset:!0,node:null};return a}function le(t){console.log(t)}N.prototype=g,N.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},N.prototype.pi={value:Math.PI,valueset:!0,node:null};const et=$e;function se(t){const e={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:x,standardFunctionAsync:L,evaluateIdentifier:W};for(let r=0;r<t.length;r++)t[r].registerFunctions(e);for(const r in e.functions)g[r]={value:new Z(e.functions[r]),valueset:!0,node:null},N.prototype[r]=g[r];for(let r=0;r<e.signatures.length;r++)he(e.signatures[r],"async")}async function tt(t,e){let r=e.spatialReference;r==null&&(r=new $({wkid:102100}));let a=null;t.usesModules&&(a=new Y(new Map,t.loadedModules));const o=ie(e.vars,e.customfunctions,e.timeZone),n={spatialReference:r,services:e.services,exports:{},libraryResolver:a,abortSignal:e.abortSignal===void 0||e.abortSignal===null?{aborted:!1}:e.abortSignal,globalScope:o,console:e.console??le,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}};let i=await c(n,t);if(i instanceof y&&(i=i.value),i instanceof O&&(i=i.value),i===p&&(i=null),i===b)throw new l(n,s.IllegalResult,null);if(i===k)throw new l(n,s.IllegalResult,null);if(v(i))throw new l(n,s.IllegalResult,null);return i}se([ge]);export{tt as executeScript,se as extend,et as functionHelper};
