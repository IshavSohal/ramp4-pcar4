import{ac as p}from"./main-C02UbYD7.js";import{h as c}from"./PooledRBush-Cuos7iZm.js";import{i as u}from"./MeshLocalVertexSpace-CpZ2bRnI.js";import{M as l}from"./vertexSpaceConversion-B53LQZTS.js";class x{async createIndex(r,n){const o=new Array;if(!r.vertexAttributes?.position)return new c;const t=w(r),a=n!=null?await n.invoke("createIndexThread",t,{transferList:o}):this.createIndexThread(t).result;return f().fromJSON(a)}createIndexThread(r){const n=f();if(!r)return{result:n.toJSON()};const o=new Float64Array(r.position);return r.components?d(n,o,r.components.map(t=>new Uint32Array(t))):h(n,o)}}function h(e,r){const n=new Array(r.length/9);let o=0;for(let t=0;t<r.length;t+=9)n[o++]=m(r,t,t+3,t+6);return e.load(n),{result:e.toJSON()}}function d(e,r,n){let o=0;for(const s of n)o+=s.length/3;const t=new Array(o);let a=0;for(const s of n)for(let i=0;i<s.length;i+=3)t[a++]=m(r,3*s[i],3*s[i+1],3*s[i+2]);return e.load(t),{result:e.toJSON()}}function w(e){const{vertexAttributes:{position:r},vertexSpace:n,spatialReference:o,transform:t}=e,a=l({vertexAttributes:{position:r},vertexSpace:n,spatialReference:o,transform:t},new u,{allowBufferReuse:!0})?.position;return a?!e.components||e.components.some(s=>!s.faces)?{position:a.buffer}:{position:a.buffer,components:e.components.map(s=>s.faces)}:null}function f(){return new c(9,p("esri-csp-restrictions")?e=>e:[".minX",".minY",".maxX",".maxY"])}function m(e,r,n,o){return{minX:Math.min(e[r],e[n],e[o]),maxX:Math.max(e[r],e[n],e[o]),minY:Math.min(e[r+1],e[n+1],e[o+1]),maxY:Math.max(e[r+1],e[n+1],e[o+1]),p0:[e[r],e[r+1],e[r+2]],p1:[e[n],e[n+1],e[n+2]],p2:[e[o],e[o+1],e[o+2]]}}export{x as default};
