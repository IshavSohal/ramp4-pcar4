import{cH as O,aS as z,a6 as L,cI as V,cJ as A,cK as T,cL as D,cM as P,bv as R,cN as S,cO as Y}from"./main-C02UbYD7.js";import{Z}from"./utils-C4MYMkCd.js";import{c as E,B as _}from"./utils-_XRLLn0c.js";let m=null;const j=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function K(n,e,o){return n.x<0?n.x+=e:n.x>o&&(n.x-=e),n}function U(n,e,o,s){const t=O(o)?z(o):null,c=t?Math.round((t.valid[1]-t.valid[0])/e.scale[0]):null;return n.map(r=>{const i=new L(r.geometry);return V(e,i,i),r.geometry=t?K(i,c??0,s[0]):i,r})}function k(n,e=18,o,s,t){const c=new Float64Array(s*t);e=Math.round(S(e));let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const M=Y(o);for(const{geometry:h,attributes:g}of n){const{x:I,y:u}=h,w=Math.max(0,I-e),F=Math.max(0,u-e),v=Math.min(t,u+e),b=Math.min(s,I+e),p=+M(g);for(let f=F;f<v;f++)for(let d=w;d<b;d++){const y=f*s+d,N=A(d-I,f-u,e)*p,l=c[y]+=N;r=Math.min(r,l),i=Math.max(i,l)}}return{min:r,max:i}}function C(n){const e=j.exec(n);if(!e)return null;const{hh:o,mm:s,ss:t,ms:c}=e.groups;return Number(o)*T.hours+Number(s)*T.minutes+Number(t)*T.seconds+Number(c||0)}async function B(n,e,o=!0){if(!e)return[];const{field:s,field2:t,field3:c,fieldDelimiter:r,fieldInfos:i,timeZone:M}=n,h=s&&i?.find(l=>l.name.toLowerCase()===s.toLowerCase()),g=!!h&&D(h),I=!!h&&Z(h),u=n.valueExpression,w=n.normalizationType,F=n.normalizationField,v=n.normalizationTotal,b=[],p=n.viewInfoParams;let f=null,d=null;if(u){if(!m){const{arcadeUtils:l}=await P();m=l}m.hasGeometryOperations(u)&&await m.enableGeometryOperations(),f=m.createFunction(u),d=p?m.getViewInfo({viewingMode:p.viewingMode,scale:p.scale,spatialReference:new R(p.spatialReference)}):null}const y=n.fieldInfos,N=!(e[0]&&"declaredClass"in e[0]&&e[0].declaredClass==="esri.Graphic")&&y?{fields:y}:null;return e.forEach(l=>{const x=l.attributes;let a;if(u){const $=N?{...l,layer:N}:l,G=m.createExecContext($,d,M);a=m.executeFunction(f,G)}else x&&(a=x[s],t?(a=`${E(a)}${r}${E(x[t])}`,c&&(a=`${a}${r}${E(x[c])}`)):typeof a=="string"&&o&&(I?a=a?new Date(a).getTime():null:g&&(a=a?C(a):null)));if(w&&typeof a=="number"&&isFinite(a)){const $=x&&parseFloat(x[F]);a=_(a,w,$,v)}b.push(a)}),b}export{B as b,U as j,C as w,k as x};
