import{o as a,q as s,G as c,z as C,aC as ee,ck as te,bm as re,M as Q,C as D,cN as x,cO as N,d5 as ne,cP as F,cQ as K,K as ae,e0 as oe,gr as se}from"./main-BfV_Ya13.js";import{o as M,an as ie,j as _,ar as pe,J as le,c as A,K as ce,X as J,ae as ue,ad as de,as as fe,U as B}from"./arcade-BntRb13s.js";import{a as f,r as h}from"./unitConversion-BrfTc47m.js";import{l as he}from"./portalUtils-WMQCNAz1.js";import{k as ye,K as me,O as ge}from"./projection-Xiqt9C3K.js";import we from"./PortalItem-s2Nmhpz9.js";import{m as ve,n as Ge}from"./project-0osUCB1-.js";let k=class extends C{constructor(e){super(e),this.properties=null}};a([s({json:{write:!0}})],k.prototype,"properties",void 0),k=a([c("esri.rest.knowledgeGraph.GraphObject")],k);const O=k;let w=class extends O{constructor(e){super(e),this.typeName=null,this.id=null}};a([s({type:String,json:{write:!0}})],w.prototype,"typeName",void 0),a([s({type:String,json:{write:!0}})],w.prototype,"id",void 0),w=a([c("esri.rest.knowledgeGraph.GraphNamedObject")],w);const U=w;let R=class extends U{constructor(e){super(e),this.layoutGeometry=null}};a([s({type:ee,json:{write:!0}})],R.prototype,"layoutGeometry",void 0),R=a([c("esri.rest.knowledgeGraph.Entity")],R);const V=R;let y=class extends U{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};a([s({type:String,json:{write:!0}})],y.prototype,"originId",void 0),a([s({type:String,json:{write:!0}})],y.prototype,"destinationId",void 0),a([s({type:te,json:{write:!0}})],y.prototype,"layoutGeometry",void 0),y=a([c("esri.rest.knowledgeGraph.Relationship")],y);const $=y;let T=class extends O{constructor(e){super(e)}};T=a([c("esri.rest.knowledgeGraph.ObjectValue")],T);const E=T;let j=class extends C{constructor(e){super(e),this.path=[]}};a([s({type:[O],json:{write:!0}})],j.prototype,"path",void 0),j=a([c("esri.rest.knowledgeGraph.Path")],j);const X=j;let P=class extends re{constructor(e){super(e),this.openCypherQuery=""}};a([s()],P.prototype,"openCypherQuery",void 0),P=a([c("esri.rest.knowledgeGraph.GraphQuery")],P);const Se=P;let u=class extends Se{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};a([s()],u.prototype,"bindParameters",void 0),a([s()],u.prototype,"bindGeometryQuantizationParameters",void 0),a([s()],u.prototype,"outputQuantizationParameters",void 0),a([s({type:Q})],u.prototype,"outputSpatialReference",void 0),a([s()],u.prototype,"provenanceBehavior",void 0),u=a([c("esri.rest.knowledgeGraph.GraphQueryStreaming")],u);const H=u;let m=null;async function be(e){const t=ne.geometryServiceUrl??"";if(!t){ye()||await me();for(const r of e)r.container[r.indexer]=ge(r.container[r.indexer],Q.WGS84);return}const n=e.map(r=>r.container[r.indexer]),i=new ve({geometries:n,outSpatialReference:Q.WGS84}),l=await Ge(t,i);for(let r=0;r<l.length;r++){const o=e[r];o.container[o.indexer]=l[r]}}async function L(e,t){const n=new we({portal:e,id:t});return await n.load(),m===null&&(m=await import("./streamLayerUtils-34PLcu_F.js").then(i=>i.k)),await m.fetchKnowledgeGraph(n.url)}function W(e,t,n,i,l){if(e===null)return null;if(x(e)||F(e))return e;if(J(e)||J(e))return e.toJSDate();if(ue(e))return e.toStorageFormat();if(de(e))return e.toStorageString();if(fe(e)){const r={};for(const o of e.keys())r[o]=W(e.field(o),t,n,i,l),r[o]instanceof K&&l.push({container:r,indexer:o});return r}if(N(e)){const r=e.map(o=>W(o,t,n,i,l));for(let o=0;o<r.length;o++)r[o]instanceof K&&l.push({container:r,indexer:o});return r}return B(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&t?ae(e):e:void 0}function xe(e,t){if(!e)return e;if(e.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return se(e);if(e.spatialReference.equals(t.spatialReference))return e;throw new f(t,h.WrongSpatialReference,null)}function z(e,t){if(!e)return null;const n={};for(const i in e)n[i]=v(e[i],t);return n}function v(e,t){return e===null?null:N(e)?e.map(n=>v(n,t)):e instanceof V?{graphTypeName:e.typeName,id:e.id,graphType:"entity",properties:z(e.properties,t)}:e instanceof E?{graphType:"object",properties:z(e.properties,t)}:e instanceof $?{graphTypeName:e.typeName,id:e.id,graphType:"relationship",originId:e.originId??null,destinationId:e.destinationId??null,properties:z(e.properties,t)}:e instanceof X?{graphType:"path",path:e.path?e.path.map(n=>v(n,t)):null}:B(e)?xe(e,t):x(e)||F(e)||oe(e)?e:null}function ke(e){e.mode==="async"&&(e.functions.knowledgegraphbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,(i,l,r)=>{if(M(r,2,2,t,n),r[0]===null)throw new f(t,h.PortalRequired,n);if(r[0]instanceof ie){const G=_(r[1]);let g;return g=t.services?.portal?t.services.portal:D.getDefault(),L(he(r[0],g),G)}if(x(r[0])===!1)throw new f(t,h.InvalidParameter,n);const o=_(r[0]);return L(t.services?.portal??D.getDefault(),o)})},e.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),e.functions.querygraph=function(t,n){return e.standardFunctionAsync(t,n,async(i,l,r)=>{M(r,2,4,t,n);const o=r[0];if(!pe(o))throw new f(t,h.InvalidParameter,n);const G=r[1];if(!x(G))throw new f(t,h.InvalidParameter,n);m===null&&(m=await import("./streamLayerUtils-34PLcu_F.js").then(p=>p.k));let g=null;const S=le(r[2],null);if(!(S instanceof A||S===null))throw new f(t,h.InvalidParameter,n);if(S){let p=[];g=W(S,!0,!1,t,p),p=p.filter(d=>!d.container[d.indexer].spatialReference.isWGS84),p.length>0&&await be(p)}const q=new H({openCypherQuery:G,bindParameters:g});(o?.serviceDefinition?.currentVersion??11.3)>11.2&&(q.outputSpatialReference=t.spatialReference);const Y=(await m.executeQueryStreaming(o,q)).resultRowsStream.getReader(),I=[];try{for(;;){const{done:p,value:d}=await Y.read();if(p)break;if(N(d))for(const b of d)I.push(v(b,t));else{const b=[];for(const Z of d)b.push(v(d[Z],t));I.push(b)}}}catch(p){throw p}return A.convertJsonToArcade(I,ce(t),!1,!0)})},e.signatures.push({name:"querygraph",min:2,max:4}))}const Re=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:ke},Symbol.toStringTag,{value:"Module"}));export{X as a,H as b,V as c,Re as k,$ as p,E as t};
