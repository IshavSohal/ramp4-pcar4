import{bN as u,E as f,bO as y,bP as T,ae as d,bQ as $,a9 as g,bR as Z,bS as b,bT as w}from"./main-BfV_Ya13.js";import"./mat4f32-CiZjBg9k.js";import"./mat4-Di4dhsGR.js";import"./intl-COKPH5ci.js";import{h as S}from"./timeZoneUtils-Cm0FyoVY.js";const U=",",C={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},N=new Set(["integer","small-integer"]);let l=null;function D(t){return g(t)||Z(t)||b(t)}async function M(t){const{field:n,field2:e,field3:r,normalizationField:a,valueExpression:i}=t;let s=[];if(i){if(!l){const{arcadeUtils:o}=await w();l=o}s=l.extractFieldNames(i)}return n&&s.push(n),e&&s.push(e),r&&s.push(r),a&&s.push(a),s}function m(t){return String(t).padStart(2,"0")}function p(t,n,e){let r;return n==="date"||n==="number"?(n==="number"&&(t=new Date(t)),r=`TIMESTAMP'${e?t.getFullYear():t.getUTCFullYear()}-${m((e?t.getMonth():t.getUTCMonth())+1)}-${m(e?t.getDate():t.getUTCDate())} ${m(e?t.getHours():t.getUTCHours())}:${m(e?t.getMinutes():t.getUTCMinutes())}:${m(e?t.getSeconds():t.getUTCSeconds())}'`):r=t,r}function v(t,n,e,r){const{hasQueryEngine:a}=t,i=`(${p(e,h(t,e),a)} - ${p(n,h(t,n),a)})`;let s=C[r],o="/";return s<1&&(s=1/s,o="*"),{sqlExpression:s===1?i:`(${i} ${o} ${s})`,sqlWhere:null}}function h(t,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const e=t.getField(n);if(n.toLowerCase()==="<now>")return;if(g(e))return"field"}}function E(t,n){const e=n&&t.getField(n);return!!e&&N.has(e.type)}function F(t){return`cast(${t} as float)`}function x(t,n){const{format:e,timeZoneOptions:r,fieldType:a}=n??{};let i,s;if(r&&({timeZone:i,timeZoneName:s}=S(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,u(e||"short-date-short-time"),a)),typeof t=="string"&&isNaN(Date.parse(a==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(a){case"date-only":{const o=u(e||"short-date");return typeof t=="string"?$(t,{...o}):f(t,{...o,timeZone:d})}case"time-only":{const o=u(e||"short-time");return typeof t=="string"?T(t,o):f(t,{...o,timeZone:d})}case"timestamp-offset":{if(!i&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const o=e||r?u(e||"short-date-short-time"):void 0,c=o?{...o,timeZone:i,timeZoneName:s}:void 0;return typeof t=="string"?y(t,c):f(t,c)}default:{const o=e||r?u(e||"short-date-short-time"):void 0;return f(typeof t=="string"?new Date(t):t,o?{...o,timeZone:i,timeZoneName:s}:void 0)}}}export{D as $,F as M,x as N,M as U,U as f,E as j,v as k};
