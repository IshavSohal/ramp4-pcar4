import{o as r,q as _,G as p,bm as u,c7 as o,c8 as g,c9 as c,aT as m,N as l,A as H}from"./main-BfV_Ya13.js";let i=class extends u{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(s,e,t={}){return this._installWatch(s,e,t,o)}addWhen(s,e,t={}){return this._installWatch(s,e,t,g)}addOnCollectionChange(s,e,{initial:t=!1,final:n=!1}={}){const a=++this._handleId;return this.addHandles([c(s,"after-changes",this._createSyncUpdatingCallback(),m),c(s,"change",e,{onListenerAdd:t?d=>e({added:d.toArray(),removed:[]}):void 0,onListenerRemove:n?d=>e({added:[],removed:d.toArray()}):void 0})],a),l(()=>this.removeHandles(a))}addPromise(s){if(s==null)return s;const e=++this._handleId;this.addHandles(l(()=>{this._pendingPromises.delete(s)&&(this._pendingPromises.size!==0||this.hasHandles(h)||this._set("updating",!1))}),e),this._pendingPromises.add(s),this._set("updating",!0);const t=()=>this.removeHandles(e);return s.then(t,t),s}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(s,e,t={},n){const a=++this._handleId;t.sync||this._installSyncUpdatingWatch(s,a);const d=n(s,e,t);return this.addHandles(d,a),l(()=>this.removeHandles(a))}_installSyncUpdatingWatch(s,e){const t=this._createSyncUpdatingCallback(),n=o(s,t,{sync:!0,equals:()=>!1});return this.addHandles(n,e),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(h),++this._scheduleHandleId;const s=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(H(()=>{s===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(h))}),h)}}};r([_({readOnly:!0})],i.prototype,"updating",void 0),i=r([p("esri.core.support.UpdatingHandles")],i);const h=-42;export{i as h};
